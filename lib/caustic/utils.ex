defmodule Caustic.Utils do
  use Bitwise

  @moduledoc """
  A collection of useful methods in cryptography and number theory.
  """
  
  @base58_table "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"
  @base_prefixes %{2 => "0b", 16 => "0x"}
  @base58_version %{
    address: <<0x00>>, # base58 starts with 1
    address_p2sh: <<0x05>>, # base58 starts with 3
    address_testnet: <<0x6f>>, # base58 starts with m/n
    private_key_wif: <<0x80>>, # base58 starts with 5 for uncompressed and K/L for compressed
    private_key_bip38_encrypted: <<0x0142::size(16)>>, # base58 starts with 6P
    public_key_bit32_extended: <<0x0488b21e::size(32)>> # base58 starts with xpub
  }
  
  # https://oeis.org/A000043
  # https://en.wikipedia.org/wiki/Mersenne_prime
  # Primes p such that 2^p - 1 is prime.
  @mersenne_exponents [
    2,        3,        5,        7,        13,       17,       19,      31,      61,       89,
    107,      127,      521,      607,      1279,     2203,     2281,    3217,    4253,     4423,
    9689,     9941,     11213,    19937,    21701,    23209,    44497,   86243,   110503,   132049,
    216091,   756839,   859433,   1257787,  1398269,  2976221,  3021377, 6972593, 13466917, 20996011,
    24036583, 25964951, 30402457, 32582657, 37156667, 42643801, 43112609]
  
  # https://oeis.org/A000668
  # https://en.wikipedia.org/wiki/Mersenne_prime
  # Primes of the form 2^p - 1 where p is a prime.
  @mersenne_primes [
    3, 7, 31, 127, 8191, 131071, 524287, 2147483647,
    2305843009213693951, 618970019642690137449562111,
    162259276829213363391578010288127,
    170141183460469231731687303715884105727,
    6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151,
    531137992816767098689588206552468627329593117727031923199444138200403559860852242739162502265229285668889329486246501015346579337652707239409519978766587351943831270835393219031728127,
    10407932194664399081925240327364085538615262247266704805319112350403608059673360298012239441732324184842421613954281007791383566248323464908139906605677320762924129509389220345773183349661583550472959420547689811211693677147548478866962501384438260291732348885311160828538416585028255604666224831890918801847068222203140521026698435488732958028878050869736186900714720710555703168729087,
    1475979915214180235084898622737381736312066145333169775147771216478570297878078949377407337049389289382748507531496480477281264838760259191814463365330269540496961201113430156902396093989090226259326935025281409614983499388222831448598601834318536230923772641390209490231836446899608210795482963763094236630945410832793769905399982457186322944729636418890623372171723742105636440368218459649632948538696905872650486914434637457507280441823676813517852099348660847172579408422316678097670224011990280170474894487426924742108823536808485072502240519452587542875349976558572670229633962575212637477897785501552646522609988869914013540483809865681250419497686697771007,
    446087557183758429571151706402101809886208632412859901111991219963404685792820473369112545269003989026153245931124316702395758705693679364790903497461147071065254193353938124978226307947312410798874869040070279328428810311754844108094878252494866760969586998128982645877596028979171536962503068429617331702184750324583009171832104916050157628886606372145501702225925125224076829605427173573964812995250569412480720738476855293681666712844831190877620606786663862190240118570736831901886479225810414714078935386562497968178729127629594924411960961386713946279899275006954917139758796061223803393537381034666494402951052059047968693255388647930440925104186817009640171764133172418132836351,
    259117086013202627776246767922441530941818887553125427303974923161874019266586362086201209516800483406550695241733194177441689509238807017410377709597512042313066624082916353517952311186154862265604547691127595848775610568757931191017711408826252153849035830401185072116424747461823031471398340229288074545677907941037288235820705892351068433882986888616658650280927692080339605869308790500409503709875902119018371991620994002568935113136548829739112656797303241986517250116412703509705427773477972349821676443446668383119322540099648994051790241624056519054483690809616061625743042361721863339415852426431208737266591962061753535748892894599629195183082621860853400937932839420261866586142503251450773096274235376822938649407127700846077124211823080804139298087057504713825264571448379371125032081826126566649084251699453951887789613650248405739378594599444335231188280123660406262468609212150349937584782292237144339628858485938215738821232393687046160677362909315071,
    190797007524439073807468042969529173669356994749940177394741882673528979787005053706368049835514900244303495954950709725762186311224148828811920216904542206960744666169364221195289538436845390250168663932838805192055137154390912666527533007309292687539092257043362517857366624699975402375462954490293259233303137330643531556539739921926201438606439020075174723029056838272505051571967594608350063404495977660656269020823960825567012344189908927956646011998057988548630107637380993519826582389781888135705408653045219655801758081251164080554609057468028203308718724654081055323215860189611391296030471108443146745671967766308925858547271507311563765171008318248647110097614890313562856541784154881743146033909602737947385055355960331855614540900081456378659068370317267696980001187750995491090350108417050917991562167972281070161305972518044872048331306383715094854938415738549894606070722584737978176686422134354526989443028353644037187375385397838259511833166416134323695660367676897722287918773420968982326089026150031515424165462111337527431154890666327374921446276833564519776797633875503548665093914556482031482248883127023777039667707976559857333357013727342079099064400455741830654320379350833236245819348824064783585692924881021978332974949906122664421376034687815350484991,
    285542542228279613901563566102164008326164238644702889199247456602284400390600653875954571505539843239754513915896150297878399377056071435169747221107988791198200988477531339214282772016059009904586686254989084815735422480409022344297588352526004383890632616124076317387416881148592486188361873904175783145696016919574390765598280188599035578448591077683677175520434074287726578006266759615970759521327828555662781678385691581844436444812511562428136742490459363212810180276096088111401003377570363545725120924073646921576797146199387619296560302680261790118132925012323046444438622308877924609373773012481681672424493674474488537770155783006880852648161513067144814790288366664062257274665275787127374649231096375001170901890786263324619578795731425693805073056119677580338084333381987500902968831935913095269821311141322393356490178488728982288156282600813831296143663845945431144043753821542871277745606447858564159213328443580206422714694913091762716447041689678070096773590429808909616750452927258000843500344831628297089902728649981994387647234574276263729694848304750917174186181130688518792748622612293341368928056634384466646326572476167275660839105650528975713899320211121495795311427946254553305387067821067601768750977866100460014602138408448021225053689054793742003095722096732954750721718115531871310231057902608580607,
    4782202788054612029528392986600059097414971724022365008513345109918378950942662970278927686112707894586824720981524256319306585052676834087480834429433264797425893247623688331021633208954847354805799943341309825989013743806187109581043148680813778321530496715601563282624414040398143207622036272190408590790537203475256105564071579263867875240985573356522656108542128577321057879052328865035355873615679363655889925711574420153832091752422843046918811427400662135559303516853703976812686385750376227787949580582081831261725701003498206512329872677233489510953469375683037038373999696771585788905639115522613405495707184524158219208223766442059014593330657009722153962376853423770486138578089775621301167811299166407361746606697808186757966914671246073712904200588408923186387737887675292886953797066980967406053530122853539036965490224784924649007954898678503314655546475504501686187354866964374552614120640782949622452027788962138602665933147687696322089504278791624651519312327831756553779377194524673395819281486668576384019590720179413349582970319393884388810494546040342087536563628332152073181614300721769371426238517540520845214665313301183551962591849558938499025348780376716477073930634436840084468255937443451690315999349137664638968972614199015304906547819056227171224947070739716300953775743441307920501863532234466545645695774331885044978250148663467372130392099894852145190998232878772486650513010816769902892518719250066947215706536216248696240569256865554296221552211560427778662545936998801070186162601476474293459830183651273363462732675883060701410359254829149774339297173680765610959599911309189788238350131635672661435969218239977196933874395403996623675580528211207136396370858056051160781770985452576988032333812939272752101944629527490313835551985197095928885236415301789218675141014541203096191270934369039522098280317668942061325572349643638403056487349290884223786292887472231219032385281034091824306618947740727265524284893304474861454942076799041739447165838281671410435831206790501914527326287370339974707206016882562827404270170322606727980343479326425730091839813077719322455394763960606588214326603156141490740557698055166263044447583756711516490181193442236859424151843795389335765432129944054855345155859273424561825146813714720606287781021240923708021492298349635179527270302962970156927686511635050080407282674252362644695710769768866137302789313609674382719017385508484663373476120843567983065059558072935110637544240807350667082987233779768874938983584523095638996120616318634391967112086464384649470963230072729200912586147267999762496709852769503535733924416202657720741248683592202828983311140833923302433917797976990311425843619350936754483811194408812763388084204451804912454383884180800945275626668057628954763384641305107753773247082495804533355717481965025070819730466422826105697510564289798951182192885976352229053898948737614642139910911535864505818992696826225754111,
    34608828249085121524296039576741331672262866890023854779048928344500622080983411446436437554415370753366448674763505018641470709332373970608376690404229265789647993709760358469552319045484910050304149809818540283507159683562232941968059762281334544739720849260904855192770626054911793590389060795981163838721432994278763633095377438194844866471124967685798888172212033000821469684464956146997194126921284336206463313859537577200462442029064681326087558257488470489384243989270236884978643063093004422939603370010546595386302009073043944482202559097406700597330570799507832963130938739885080198416258635194522913042562936679859587495721031173747796418895060701941717506001937152430032363631934265798516236047451209089864707430780362298307038193445486493756647991804258775574973833903315735082891029392359352758617185019942554834671861074548772439880729606244911940066680112823824095816458261761861746604034802056466823143718255492784779380991749580255263323326536457743894150848953969902818530057870876229329803338285735419228259022169602665532210834789602051686546011466737981306056247480055071718250333737502267307344178512950738594330684340802698228963986562732597175372087295649072830289749771358330867951508710859216743218522918811670637448496498549094430541277444079407989539857469452772132166580885754360477408842913327292948696897496141614919739845432835894324473601387609643750514699215032683744527071718684091832170948369396280061184593746143589068811190253101873595319156107319196071150598488070027088705842749605203063194191166922106176157609367241948160625989032127984748081075324382632093913796444665700601391278360323002267434295194325607280661260119378719405151497555187549252134264394645963853964913309697776533329401822158003182889278072368602128982710306618115118964131893657845400296860012420391376964670183983594954112484565597312460737798777092071706710824503707457220155015899591766244957768006802482976673920392995410164224776445671222149803657927708412925555542817045572430846389988129960519227313987291200902060882060733762075892299473666405897427035811786879875694315078654420055603469625309399653955932310466430039146465805452965014040019423897552675534768248624631951431493188170905972588780111850281190559073677771187432814088678674286302108275149258477101296451833651979717375170900505673645964696355331369819296000267389583289299126738345726980325998955997501176664201042888546085699446442834195232948787488410595750197438786353119204210855804692460582533832967771946911459901921324984968810021189968284941331573164056304725480868921823442538199590383852412786840833479611419970101792978355653650755329138298654246225346827207503606740745956958127383748717825918527473164970582095181312905519242710280573023145554793628499010509296055849712377978984921839997037415897674154830708629145484724536724572622450131479992681684310464449439022250504859250834761894788889552527898400988196200014868575640233136509145628127191354858275083907891469979019426224883789463551,
    2814112013697373133393152975842584191818662382013600787892419349345515176682276313810715094745633257074198789308535071537342445016418881801789390548709414391857257571565758706478418356747070674633497188053050875416821624325680555826071110691946607460873056965360830571590242774934226866183966309185433462514537484258655982386235046029227507801410907163348439547781093397260096909677091843944555754221115477343760206979650067087884993478012977277878532807432236554020931571802310429923167588432457036104110850960439769038450365514022349625383665751207169661697352732236111926846454751701734527011379148175107820821297628946795631098960767492250494834254073334414121627833939461539212528932010726136689293688815665491671395174710452663709175753603774156855766515313827613727281696692633529666363787286539769941609107777183593336002680124517633451490439598324823836457251219406391432635639225604556042396004307799361927379900586400420763092320813392262492942076312933268033818471555255820639308889948665570202403815856313578949779767046261845327956725767289205262311752014786247813331834015084475386760526612217340579721237414485803725355463022009536301008145867524704604618862039093555206195328240951895107040793284825095462530151872823997171764140663315804309008611942578380931064748991594407476328437785848825423921170614938294029483257162979299388940695877375448948081108345293394327808452729789834135140193912419661799488795210328238112742218700634541149743657287232843426369348804878993471962403393967857676150371600196650252168250117793178488012000505422821362550520509209724459895852366827477851619190503254853115029403132178989005195751194301340277282730390683651120587895060198753121882187788657024007291784186518589977788510306743945896108645258766415692825664174470616153305144852273884549635059255410606458427323864109506687636314447514269094932953219924212594695157655009158521173420923275882063327625408617963032962033572563553604056097832111547535908988433816919747615817161606620557307000377194730013431815560750159027842164901422544571224546936793234970894954668425436412347785376194310030139080568383420772628618722646109707506566928102800033961704343991962002059794565527774913883237756792720065543768640792177441559278272350823092843683534396679150229676101834243787820420087274028617212684576388733605769491224109866592577360666241467280158988605523486345880882227855505706309276349415034547677180618296352866263005509222254318459768194126727603047460344175581029298320171226355234439676816309919127574206334807719021875413891580871529049187829308412133400910419756313021540478436604178446757738998632083586207992234085162634375406771169707323213988284943779122171985953605897902291781768286548287878180415060635460047164104095483777201737468873324068550430695826210304316336385311384093490021332372463463373977427405896673827544203128574874581960335232005637229319592369288171375276702260450911735069504025016667755214932073643654199488477010363909372005757899989580775775126621113057905717449417222016070530243916116705990451304256206318289297738303095152430549772239514964821601838628861446301936017710546777503109263030994747397618576207373447725441427135362428360863669327157635983045447971816718801639869547525146305655571843717916875669140320724978568586718527586602439602335283513944980064327030278104224144971883680541689784796267391476087696392191,
    43154247973881626480552355163379198390539350432267115051652505414033306801376580911304513629318584665545269938257648835317902217334584413909528269154609168019007875343741396296801920114486480902661414318443276980300066728104984095451588176077132969843762134621790396391341285205627619600513106646376648615994236675486537480241964350295935168662363909047948347692313978301377820785712419054474332844529183172973242310888265081321626469451077707812282829444775022680488057820028764659399164766265200900561495800344054353690389862894061792872011120833614808447482913547328367277879565648307846909116945866230169702401260240187028746650033445774570315431292996025187780790119375902863171084149642473378986267503308961374905766340905289572290016038000571630875191373979555047468154333253474991046248132504516341796551470575481459200859472614836213875557116864445789750886277996487304308450484223420629266518556024339339190844368921018424844677042727664601852914925277280922697538426770257333928954401205465895610347658855386633902546289962132643282425748035786233580608154696546932563833327670769899439774888526687278527451002963059146963875715425735534475979734463100678367393327402149930968778296741391514599602374213629898720611431410402147238998090962818915890645693934483330994169632295877995848993366747014871763494805549996163051541225403465297007721146231355704081493098663065733677191172853987095748167816256084212823380168625334586431254034670806135273543270714478876861861983320777280644806691125713197262581763151313596429547763576367837019349835178462144294960757190918054625114143666384189433852576452289347652454631535740468786228945885654608562058042468987372436921445092315377698407168198376538237748614196207041548106379365123192817999006621766467167113471632715481795877005382694393400403061700457691135349187874888923429349340145170571716181125795888889277495426977149914549623916394014822985025331651511431278802009056808456506818877266609831636883884905621822262933986548645669080672191704740408891349835685662428063231198520436826329415290752972798343429446509992206368781367154091702655772727391329424277529349082600585884766523150957417077831910016168475685658673192860882070179760307269849987354836042371734660257694347235506301744118874141292438958141549100609752216882230887611431996472330842380137110927449483557815037586849644585749917772869926744218369621137675101083278543794081749094091043084096774144708436324279476892056200427227961638669149805489831121244676399931955371484012886360748706479568669048574782855217054740113945929622177502575565811067452201448981991968635965361551681273982740760138899638820318776303668762730157584640042798880691862640268612686180883874939573818125022279689930267446255773959542469831637863000171279227151406034129902181570659650532600775823677398182129087394449859182749999007223592423334567850671186568839186747704960016277540625331440619019129983789914712515365200336057993508601678807687568562377857095255541304902927192220184172502357124449911870210642694565061384919373474324503966267799038402386781686809962015879090586549423504699190743519551043722544515740967829084336025938225780730880273855261551972044075620326780624448803490998232161231687794715613405793249545509528052518010123087258778974115817048245588971438596754408081313438375502988726739523375296641615501406091607983229239827240614783252892479716519936989519187808681221191641747710902480633491091704827441228281186632445907145787138351234842261380074621914004818152386666043133344875067903582838283562688083236575482068479639546383819532174522502682372441363275765875609119783653298312066708217149316773564340379289724393986744139891855416612295739356668612658271234696438377122838998040199739078061443675415671078463404673702403777653478173367084844734702056866636158138003692253382209909466469591930161626097920508742175670306505139542860750806159835357541032147095084278461056701367739794932024202998707731017692582046210702212514120429322530431789616267047776115123597935404147084870985465426502772057300900333847905334250604119503030001704002887892941404603345869926367501355094942750552591581639980523190679610784993580896683299297681262442314008657033421868094551740506448829039207316711307695131892296593509018623094810557519560305240787163809219164433754514863301000915916985856242176563624771328981678548246297376249530251360363412768366456175077031977457534912806433176539995994343308118470147158712816149394421276614228262909950055746981053206610001560295784656616193252269412026831159508949671513845195883217147982748879261851417819979034417285598607727220866677680426090308754823803345446566305619241308374452754668143015487710877728011086004325892262259413968285283497045571062757701421761565262725153407407625405149931989494459106414660534305378576709862520049864880961144869258603473714363659194013962706366851389299692869491805172556818508298824954954815796063169517658741420159798754273428026723452481263569157307213153739781041627653715078598504154797287663122946711348158529418816432825044466692781137474494898385064375787507376496345148625306383391555145690087891955315994462944493235248817599907119135755933382121706191477185054936632211157222920331148502487563303118018805685073569841580518118710778653953571296014372940865270407021924383167290323231567912289419486240594039074452321678019381871219092155460768444573578559513613304242206151356457513937270939009707237827101245853837678338161023397586854894230696091540249987907453461311923963852950754758058205625956600817743007191746812655955021747670922460866747744520875607859062334750627098328593480067789456169602494392813763495657599847485773553990957557313200809040830036446492219409934096948730547494301216165686750735749555882340303989874672975455060957736921559195480815514035915707129930057027117286252843197413312307617886797506784260195436760305990340708481464607278955495487742140753570621217198252192978869786916734625618430175454903864111585429504569920905636741539030968041471,
    44867916611904333479495141036159177872720902372938861301036480447512785609158053637162018395920183108689149613973035533621134551674715287880007134345347194681025732056939825423723521750452980127215084299527266875706892007262798468825185681532142985720637290299313726344463257416449344509835102458816789016394945893696705168502436180232259551672603295389186364437045681350697590862198047118901225352609650331560624641680529360950276322519541199378781611887950368067065467094570602703933944508795918017973611326798274338403964825448745270434393258865935311826270281291301767537362073560471706796018086986188192305477308263143033689309402401116023184218739861793173381674293624039080146446533167893142403441626243986354829868152963856856097613981370008545290902178852760181267516916666189196652889272405457548015727583223936389690623948268629738406595342536881770621194098884299042222510205198907427651269590866489020849331593183544730378438673619905441075619665362094087700417583472204239335761771260615063239687136058218014855376128809648109025328444692060981149171853122623214490315199270347679840250650446624361158632712607371820441076129040576076156413981966443384174935945557589269550551384444249641738589326431062350244259749888495427561113138125373546749571089212977055534105306317668036525450115619994704703080975001831039096328170193148671686659220369588362291591980963840251182084839045643052580945876198697254235294718583716788165976228557375284260972377346244685323620326927812128869122804644917707943186384476057711810558228653120572801809938250702311789320142979213175068746598525343177694757992501015403459055756096150131796369342571712916973547166474698856592132612717244249685861542410597610354729550125380584497109056463991926448357223209008827764713220228439775757230755516658614028292960947522709456751199752268424383084190316769975828969408161512929731166188774631973942613003505328030528435929861943028814647224393409604332129915709479716480001751152901047730022099226496393622633345405009361146955156338963448113785646130979933903537929751619768669550563002423706161236691536299577305442116055910462682405728304933022695634876033547918117176704431651372729753611485207957283097607765933169252913861287726833830000755907168496373643201886627226059186824987046158950280121480310106220821760865120562920439756658081153617726352709131801387158672559847396101178548655217308890158788609324326427919178121708326042669857675282709609677929532780738060001705557411238564945972873592110131239116174462947424279402757853073650206058072089139080813381552120237889176959032725532187981806390188976611966923383780080589571180304127953763426872458894003176440733448130784320760858250357720163697308151884697269173048039142351116460009341135465682559795451407065757164712682892684340399927996841540378943787439234382545562253973300003977291497945580368468642313784723553952911754115108385290054865563784523161325911184338403975092561182541488447059744171236348865292897919507096247432485742758096709852132553243687088002636637356883647209281384466468348661473539477676114713952390574283871138643608927689646270265436227072361361556969326026972555137795806131512078396392381117163021488319719122953967241849650035686516897636532829829413559438271078909648012546818155830670649731025924561052079518365511691315910359549578098542021850858860195694976630351366074278129451101792937644085504395275589852388064138602439346909569031381270272833205694814223411334423565977453887542395353485301546284835327702006873689327611630437966491140077951840154972590243416512380587609900111470825767310676939441942826834427612997756892340669203408743659224466633723212596650417249730825215118303577011272768581293371366148392778532335573122542905472394542069919985611732624482347646980930805586007081976261003097963198812882873782621377463926668786498204922447802136607398552526766227205124310008056632919363553194966717056709446690809053625020657218419836547624618595375352039018705449062959037038925284556675116361168237279922207920794703117075921951295707710873733317931433110923531405719416365240907518118794096775462324423434250371711420947553571555908465792580645089870615111865933553809003552706994499748706917899889082891225016257753453229705906397483096836459677640750701051127649136815511445021677568414826304009394300853762240103073543616073297109679097852591173721376034038403903797326084264850909622924265141840684883798695123898530601713627917934581206083528373369371952855787986368194089909153037760311683730584329384267492189510884229753903906808988993523259437606901944039838823315225488711871355530334671879703287493612171018890720047791219983006575690550227543246901734749051876793980240930546447655515405860615566182339568500526080685358056916078877218441535928716267560418132595102517522928981353833074067246933111570873295331815501725771241383698605105802286768924861382741652271179538064625778814288737402101220075694269814240934893379113612806306410045157701609671517543787442511524203121293023260598375610136932287924468473569626893292863959506611559181514200293625478634965230187600993204860736747921056014359652196606989325320755082356901630669240688685505174445515739151017185696401582807173431580481627122423292641208991071222953038343766541925054971737959169869292375645057151727543470106206531135735154136115144300015873080448570355596137321380062748881332031472142823024949510022409370177712994235289702790490255826941441774321618772576455298250619988354955614763200793811728997204477597638052792510878225745663494703701392574625552528908681553926116252158243953964293657171414581341823547346468074289772645946104841180801333621512150598625594195401601933368973292090945435953301875202828322848138663871822530516790587144451339179411203328134884327892252621182901800244630979609876813374281202935998128401633959108387881070976339195584757402099414224321539543476019604874975720230127703172732861447718691961098975942332752633167063512960112700154075209382155551695503282689329429789346503176351007528609841743736084042408094015850910964618482805649640269394165006760210370817982850495571836159005709917919149733735278914364020463842602726375487527643414975692020200079346255666615166515258291939313433912222614621242014153365037286833662921186290423547789663783785467893012638041082143785487398866487992341179948504338667781255945413472465246231194881401316071628427281713042247869185631200192333698966933544361629391311041730956501694662754558875644345191269279600693551809271956450264294092857410828353511882751,
    402874115778988778181873329071591767722438506891622420041029963578694595240887400867639861461466537103833299413586592359075505942560215384203202392505282949645966546812986702462936795598139258862134305524073117514011710850957577155764134526698071154024866570291655743611106521552616792435986397703408624275326274514077603381064824129105663607213717473307176156322769664543742767983969318459384059938379878060275572931297882085263728828117679720478536475397347975085800596808241438126653968141997207758226940295714228111203845566219741262180987691210467038513314695804493896376930579454464107580662751095564143792253350149446963327062164865068284526946953787948865977316436004163037670156288981621675415729125137439286714883498899856647713325489027165934178641826671600314908207707581913028677627336873027019891101782199420387568674902708563560335665422249993344641004256625323906242830818468942899074234949993913859729756509148940793762235052397899476747243354482142341818566675079971966290454555100106794831122873316939190687807078076069507534444543783013175183099338301868495249460351437732629139146367120478550987016051281632788132605645720897509405100164087829546634973283901954415020317318121023343421442100924240630449162568320542266025029163898709299519931364601129148550918588500543071567482692038979207121165184595857972650794067721766663304877552877530735512541831254657221163688520010481326670262947292075214957731951219393131136071700066722769000670606191390991061973242967512911264351947043296980084166552860987471716618776310267311799281849825634572094586351568980001270007699500229311699965157159517665682831428949194388823813435669597457534867460620737424901559011466473739067552420314197465985734592045469444007987504268282567422361912607903782885199294253733275346340104383835614315889419535761215302433931746650845594336694703703807737307164962815978286100833828641206436538659807846921750141914508632328601539864514384665868751711078980714897238167180581728616753062507511747249245808005997622111641863200180907569048105964570792432318670249656718941478701386677886972338475477550756278048908745855857140396160840915640000152942757067579080105948100791236006113816027294954023517657545229368410211569897436302803253236256834802174708129208380881582322497874260497465180326565377356632463319881488797716878813402070865003833358109311401638399789940308755319571548916779442616446407624398435974737254859567216330307251241356103982692307671884438420399664712045747717349853326279186496926627476702835365616635120395298094996813494640292537645025964806763617960757534317599906545186285779936362239640963157278962749735238734018031963137162294519353089671616839856140612934423376292800357002337948291195231891916319254587638023719991739894135357667509038890693762240291980336551006243082475037374270454634055589954829529267653294431255919681866264708150515182120867007206266224413578578766316288292200080204069908595880864904593530195791992836066271397322016336401432076989173442258953647032430558877151892524852554146167146883853769910561246320694705512457088921711978644056703135770947386634729787650241736975543224255147223770741629765650171444541115341186577164267009666521778404007908942572204437357536447013202320449087374359119884688896570653153635965699349888166816675325403419739923012069285047750708058098369546148066530512705922505763339363973448743551275283628656834670402770338901203538825863885273372725296802331175711226954450363493355782396416901236554095224408448515154810718941778144253019735772286555494888482992676834736600663066924318505506867453994455209613903356661381551303170707697066559694566821068447680650509746035384405738968952295270831628476713602096813200521662297702228641383037720127445077295416522867251086259308924256949130546482529205107067023263892250887651080363021211434271433397608989308330364300732585576535892044008832875413115983363441152995391893368657891779064964168643604233277423002160282408650562356013737533053786211598736805557064344886640795852215801092988641923941455936928232399558235098270821534926531103513400970081240298921105811469814438250610289016969531556231773644918713398451013610901563088260312670567852392406888546913219408585158313060052720828019956940355099824708223899549815719733824216351158321846675607771810334138571606559041577651060598586410945242414351010571013653342029095141793703879402055123962938698179828584589043431623461565217092474712504108095507185137084361406290374948975337884073889633379670194520143162505535982480557240745650789504233993776048710965080738857416484988531003380895803114702386171393470918048735414818380392458071193268641579841938267935481009786061474906992721678353184487194850249990636982112425783667423987765795687026140087895862977235482997376826723315374113237914901333805371711741433497851736832069992653855870002553569186840659098607217033947804144416745928019424098692156435119983976508231816318389379221957628808432933260158025696921301498898560750488043621000694853960738388398663132023687388772635827865444684904043842288121464832536246661065981285950218766526563040447477195329513732641090495498177569836233890464798843005307726003216676981448433911814358187830997562426197639363770484733809493659989183378814319610238163619306208581346901169487332307324999289816374403929506251166966203697910688044201904373375047065577539903412318702343216051705155579477611929334487133386363680801795105965377097317217740629067636115194380331872850516648735434607676631522745733922691440568189717446200213790341992006002410924699429964335507377264900571748863080009435280275806683231919932634328199443166043464046805502904952823468304240431789051431145750174780573029159376608897423116657754646993377252058996584317021186517859545402948554640815812580111812135719244094927777605138918240574534813561862500330654244571788812378520927064783435122985854726038472730062101845156241692016024941211265239314166182038758409312685384765540405212510964896838371037304156419933879530352086544022535109789602027747223650858853482671648101755365481354228091863805011621578883875669404903355089888549376208723682090564341102930475228163313059215959271226081949848477889353337470684677801928746328252980236259643089082064765819268977684271297091434221420402203204816051843790924312901306330991292496802744363898396613407782196679612383549415610569783891526919396336077461916416010666683822481030966646694241533372863428935782537171867644640829719942202233252584945211114561669570501261079454174419086577258210544440106662438203017786099053725933264345420108025868071488561671372008089600018372791881207012696110945775614694650737518542322556296640977293935894214414869438855358753606003397001637907083353780707434779613877126249098033493565718268305571578182703693122089543445743786026405786163677453587602709733484635893390989079294709002676276094965852942303062635499907856117575009515746557862539764756574427752110896827606786025282039152876055050854511817293890036743355523779264511,
    854509824303633803193300705318403036509901591304021058343269258282290064782167635856200500014457645861481315295253223674938340502225641436794294836286613933671922838722349286185054453799484919702814066298682412853022594582702532253637046393573819102339382603546705057592743425373988510067594258489091882652816984230481339231089370597522429657962221023625389786838476222562700937572849493656778309709848902611559817481821648562991414301186852631109919628014506891879938269919876375041476054570480393817802067642573802934320804004689212061263134937191146939217967863913998340450302066353316060446899821960016965149455247451256866120416455837785237889442736716622863694799063147972421915137281185223639485530939080700703965630524284803696329522594560178565231006428355914264455809535904827184567881970752815068646412535212946406293446404577519747900684536609902072584992617981311048365318249332003277695727334239248756022919323029881117042744212106822448167090688816268058419617823050362806871644195094989164027842731200313536528752898778625674473549278406773185197120724873440981199286044998761054195231373956949189989191876556229344730115045091462226103168618834097344609997156610133228831405954118698397360867836938451267026626659091843988180773279436086490179650284300557692234183476442984646309183072757232974100222299116389491938691664026821610953870032133749491829983634456251002018767911077341998982406542117192442961159639187837594167906896813306451433188950986000602255947701445471051471124124848433682921474574972057506821415068467850112481880920331630720013627342971796220098146625253125901337980386234817629898710708176158298693133149214166399431656277231164600237527367266776679870865785797830236117277818351059865801588376786510903900434642861824307368660843525509146180113489215970253073134536932334593263343428657338627378492178677797784904272941831813460434829238122857112185866161235173379896102730767761423558393178166224715620952758653591232586065130931612235961024495955052576313785415587572218003004463096123010675460429586233582774784375746614062343087428887376655420063237888060863198948004060435770727103254016551671980979670924439768697027789157597450820625427140967084876253330432907082362616208058343177345138018812833029933660200418178113067998719426282674176029537056946676010743381949863248322018120347951203883971813116798180480041145250934319940195212376997070020403473240618427512395565994017639267642387590352270623403841409398778197965052818880494122679879637450982929872559880623884514662196694567744027940130038179920182595248220029960545836068437836537220421151865495276144874163510998224619086027469138960543563366461310280362835876324827709909151758836738659026346983354907158533741172008557347289191834118874344507211706399728488280164719941918548596996410064074112835516746454014440640147699966792001636649078492049497299992037010722502767123614674570208325085786203978913246013088500640052780403783197363796495378941014322353383867757116808444859236033884177503488694746360263081077518495278672673007687714633814675074081403927708449052582362241943697206287236587208562293641356094566185255157887794517532173283111833000302025613005213405482252878149070265205440373545426910161611341185559050988906020137614109481965847736796392112521375419675323000779270489340923806543050956827559032136728828425649916323160041509893239953929650589544864646169009568125970129331389668409973033907297445999076186651095765310311061043682896569016209694536996136266470191569408033323541694057386738735231465391417715857531488577897250851792909910169470724853261427849940549334305896475592823992656458347993884214575074296814676874464971197215649974506724058916041508916049169707455165438683627351824021232173847650175009569246844585339764331444039879715595935280515640897481257047884715263635621831312250733095244741473379412994928937246504471873360093422945901669688636733052872215188392668343870518332217357980686070609320554480910523795553942258900948600643831553785127382196992543338144141784198002454900271443091682756574616685753240566083384505911986644720838738796540754497874824089314354427768560390125821906974331377915589874833096832220364826214637532467443257219325373542595632168868196845662314535257745740540690088721258932375726926780766042960522570262391944742291827500524719618152204706641289353527039250445951674387140964202979771525691667923635515333128240868122085666451405605834956472406582298196815961996323161565850516941679845809803706388743206005082498287908828447142468612698942513775417111948840517510717444158415311425872235504912292900931530294540012529260625223947584186787091065270997026119386422407099057687522692243445528559804365149519299366360636524787812055597948447738733157386435933019181691527123300142439165132639220658338166882600717005946057068109508190289169077800589855030939849414305609938324421065685342787335122628943893224737558800955291230162354473703668269418246876450051459098729949686427616991310346258467807714200493294634954267280195055460982624792493147249023081291160699372476860084646890874325382990275414749482976830377419937253467357638865913508180286605409768240640904878608687284690578097084189943966991203576327162981834473756946679902799601556403227035997733408463051882878040648605903489943500990090428817282136562244543138227751934870681977529470093118307377797864388134866337375506717466865840299561391687595163814871073257516237138953084739741321046512519898783055985137562909986862822821418697909218618375824776243596129635576799359999369344085923480717698699573491947266917238316136594697515748884132844396814671847273719744879357852879547726224395778018791817246412295326838150979939296919653496539270225341826037714755592301500206279366160321101433476538168211877778289236382492839507816309054101996807881965990251144060531583269667332503639847271289331205431366064069530883820899868706709436836481848789690764673023862695740597045358606957928324456815766130005846385401900094395353684780895776336253796523782075679613024968339290175813865387793255361742847784029992110588949340556741643663846869775018478118394443365250793299817506244603536408515810504456085656681183484766909632504119159101857786213084370375778253371993950568270608368720255920096107484259695785002799244185251870094775729333995933499076257379601075025939759382282614484710286255549932745375952696109293041118929794123755168354275719367365141154223682577274756986939801666353878982712419672047895827951421563601304219352939201617281945130711444593498910500078357202775578698708417758650476732444321615389586337183178052363104577036667976981794379775137254974699125521663805999652545541936035723389826056812617646779754277945047644116609828329736790436393517413288251558898045514749445906423194323706306414119366629747907481287373940832842913969451233186914869606743291916409591019592632025299628197611384253264924748540717955006148011213196330973338173358350731330358801176687055820667007316206485174294980719681580611007576366315566817988676676629818069714322226851713501056676703693691882424689948234282990975689672226518343470550974174195976295776513379484342672440028765751071277361281234011824451864987118511900268023620660925537819599017123223240195222037027161559785371968202312289222379716023280199762503203345842364475873165443711996121637218656014077109938287634462641911237643661498730924997478477798307306107972975765021697764315038032227248049476011713075846328424181343680728329020299532724418468785014598773583912750973647902334456053103347236956679606482172145264307156698559926286047178503741949513540448038604980058134803318961867847317924106411305428822060455457034623993478081873112040879949284318699106416865521492614531231783253320962518186939715705143181582332451403715983077334128673665133436729743874451580776248833276287003390901217261036364534945948597578267069197289616142254891035095245916484120686035290315924214004246222851715780026230502200012304905654599808044383293639930610712768452762188272135526848937482560309725734239359041881081604932493295818851065897194460578664420343244668944218859930843009169151416439747854996132480384642823239375104265690829603313763978877633592443681156487226034007047864955055396171494523624931526010865247828680422244153827517874928298622742605275785719186799859505979308352491593626969988121413269340766953822202945692532342274077693139016760771380343305198289191630235123888130456500445772972946518534337647490350165170146543325102202345905951720938063341522132865825600159040043213174225940378385162335105254933060024773771167209509009338521005232769588766592518165697175352104674517670696569105465127985627784868398418070770887556648506376679874586510201116038731912112614381982989015173251887069224596014819312276729672573465458064549365015500115328448677712179357286925172763809121710405012759558336757794987895061919977712975746432004968898100686118376848236917818928054045219935018646614556888891673782521226109539876603853518249396964141573474411786178864152187231072872681832426617408041561826083277082996504979905121576729761882674166062981961840205928992149503122068791348059470110958176511423269913276037734681753745733428156637089438932739933696432356682668732464139632035094818062195320955001580567851453434840805453125631107205858205890026353091573367671720125016243983573396956393115752805646325308011707276533642086384504961180674698139170920517060518064920905572492922057196081196237682745164205846001032313420319686537276432540345071367632274054907466295796072834575234227652980765772996039382235258886338751540189442236614051487377368191871254652241540528333803670931581186398680731835448665759542476167180453375355150728414382395794212745437166115535367048263957768441505047319734903176176353583999693271099471070016855442488574546932825424729408666367431733711263035317370459792311926982579362304589031818587148975192530703366798574784205700976688975137170702704092122565561067535398561047770288142891333643540586094191942881098885861170676614495216217663224969625604494749752841526809562332705130595227694664136670233457880177927254357892280283501771674153340181295757185220624956488625960241342854349445359997526435561960392392589534148436324133221048085564212838030416837663335740949389023767630410667756195923000289601031700507406595751284778714617941817407995143996744786287420431561654314601536316419773722086777893902300557814544690726153524427504853234241083524047092443029212029099057510938541927161209092151527496660113715920637523480328430989742744810118275178802273249944379671941834661049810424824484335554854300332454752382382575387785362503969349048207228022378600321077242427273559577596216705954978385577476832481767698691019969363764124908054104431258135562309403229995669410507869061560001668799471259677428825587266421236272771356548966731920925935827605895525944958390557775188182599430773976329437360627262869464537271395411127635295102553106088630644348895245378046988082281991300125435706980577758382748696320651710629889378007269601604348150095922464466723718089944069302233407247100092030141634979668048628892544474704539980677959253045377690089917491920942135794067331069174835878047355763069916910505856744867228478819552076510220321221144225115311556902621320151580940631531454823566207528919787538960710731134397251446863301951561400004159243550508846994979870220021654014363061263907055278823448015537418189345262220832101054862193900982756780966682798488261862603073406590467181148676985277920649376717780278320966958417359163686441603606338188292114506821091632091406602191783475767863949798191920391303037823635440366852329792530304401282072217590937306513920702609468017126262860885494045694567006749197056309580643372985177988939029566239014458631659924443381694125529837649434600565981192424844144940596207132164490577515769239206357734633567452508425758085518073722500745788910329276083662174307997019821662396368784000485410203494746501418379420966077237082321290470478615887034185693579996771486215404804695481122481571513704280852627012186267469991635981685640889473373475894097871907535351273155661295260715372756782780366420854197224596223931832477283860850556978410751616679570401202979195793508679229270695813501332563153166070154095763822082051684399748732729553965958532985987911797902110713318155368558266214589918316073370489457222186414248641266582577935019778268426880584442584972373506134982469960153759083758243333220265889317394698666742717430467634753497645506911473017508272050122325088825503782634226189081418110360232044483094917122073348832945196558930045450606186630066464264923682396019146123557820494410011041105352029248308941356759691092988813708083281472269286627276152071817520526023642930790051602960171096698266145887952446714972709623121336088800287469715461344195144343476677832930394086124235564902368800329544881012516861962147429738421449344065429019424751594247732152478118453408107243377529364274352501904296565836899003489345368013052920775677626638558887457826306248930171608249290273621192147578458420275754041934364280873277576348340883830877789952351851735368425837704493979337701560295930387002196518418354534911347404051951004651581481820521681180801097862520366245152535253445173913441503424092683220656401689350515658469355395408017218547191074429639783599094899320410039863575946472558059877105808942471773922977396345497637789562340536844867686961011228671,
    536927995502756321522338277992945300611020994042124005915678639443353462982103479896439555141314059601329696868637207994588201829793272648298355139552077502500922597675006568806576259537537682319598855314496743600281878930967212777337934230178148258662115597931785154398198787464683485718104780447556454938474290261453322031464806717051728004387326376315426274161049276919701791785162302398621789800222736567476576751086922042252437815857576950216810936581551290549836379143147616071707585958439732614803273694744410702078517433498695993129289109929108098912546091583458483945663710856228742769646421786042593955048775186530352081510278893380331577367000436562040054062021590840411186181330413959758811703583125532332966444256546495324358318924114113611938954990527616699010832260702093333560771629514785812406351425854817578378181247641432895384069007353009301410156167303507784506444595829666651556088101206021869205143408612030804784809199188247007267484480004463188547689057134165081635626963729877738774525747288176739403692417125168745116942663285027301808702614930797090732745446970140370457508109459814813547883216727381970474831210805511336197835126822276448269607696213660208306834614842876493143865338858432778447190334048379248043045868715014345086115732393085479559099442189190128703852065346343787925220371180624843922233302780121346367387468103323400076347188506571552827747093803520403943466763721458550107336155592436331036436133828607706547415861213048163637714599404676701242914570254596890839301461740263634948397326330456713211957065502711553902491152310086880194082183339273695201873690754015734001944336312012144997073315477679361971664229178987053172073536686513768710992623585843767413241216221204556242033980012771483270065493014924235074995321651948200630055767532506955633286704835637699240987992882919012547311202954654508534709597059494828566643653225986671034797336813206052537359272705404430589231899607358943422270724069320461112291428045839274232844628627665895284188603708277867418525677743342878082962691720031604050016860082177587425087826149146490740507378438842854123723647326829657828172692856882216025276660150664753192757003166781964692574758553198347124298804224482108172047157920858685156517095898349531026387319904805815876076778400668442424482740184825167003623109522426448145539027756151588913117656396633569200412173077578357271934849727160214821988278282616002676601928850339286920027929840294239287990449487740611847237272522895301539923017096105776647837788882935275543851719751338193361841468215111469615198200039562276019916117603967386445043381779988866697399348378689587613055776334831706231800182765322758074542702792122119522411888655613582981212657915777475329255261749315244650303478698188589624430165378071771491823991454494047503439689887296426782137492353122666436969215407232718596461931102960181224680440584245013439974887252079738317311620326677939530171469499293922064964806117804016036669916116941446344337128897338111536161036637023391971417078474920975591467312216422698961892607478650591403067584259156605986423290827981508396142690170939775581333585413643314304618507231398101580267793932182160014969787970394586699509968497380183558149127952744618559683842028766311071536735152446136671966171341157412636218981595068449801980979432426810793869908652496679107144268871635059759510309125253019134886345671721376280690349155366840425460128914747225069335909856819977492875766128914314006920790722084765226477289584933796013616338913540803350170929241165841379498915341948850672417039514954437150651945331235178407702840712814060356616024837669592405313008162391886360910550672770861240000956354134220393529492256629895535835672687457008560048213156885154519906931205974899372862515192996022849136051408422061563794906268688389756735858720654980884782118493140641309389974499988187385397253453473004147517447122481189104627948782702339487400872126371212862536633246084473298188525471319841867836534750084743338527449650694810938848987795059250781717823841797295826939215484384457265075128898551541197503302657123770305358947243972370817622314357766286824924664617312458079840237464049010300812676900067685437672407147649727255552381141508863726666024261860848931468334435263153197618540144763392128529437435017792053485785662386517067706266804997958432895640388076690189553246064332182763867770981959700177170830006563098702503652448605598122697817372883405707747867972959373288245893404470638003685137502146442606080328822261302212058836236071037251940856393861476743295204324258078547497081055824539954675729094379439942638396787960466727860467576737731060474597516122919753359624461832955515144490202929266667074135990488774935297133822706749690533265454154571252669459165486791637808926124267363628219605204427085629851380946059209530745420748839374684565870918656010770049000282684700474971060580937589660229660170596435479648473761774022009872546760793514101034841739262511469938369663141780190402694102273285019812090840550149938731149252423036188856753632811618788461398238516051918802537503534413532591180842360460936223433634717529024188971227438918359313736120119487767374070856148795081223189255526036885621263466227701630432888862213857567533044031699333514886156698794215721551367164221331365148296833446912340167792565467135738506197588641095778085680704224950017365935586652860867304590077169799315035232413675903120763478553819194700737089616707696637098412841612480856242006098208475815182403000564793019650512494959803470342043206634892098702318641226939634301319505515885828922190616032313783514914849809104096305657990874530749656510503286932924317335081647078601846232831686502334824320486617475988469214204319348054548154138150484685047918993977103404100737396775974932587446577421655609277893264446246291374956268517832319867477107500848037978458743318165837206273925328480473826924114951347202630024167605749927207753695042682035033385298594342916597234759945089523254791603358656320291583914646994925658408304427073851951520797323268679726814752841083954496763962563869112612456823615022841770483512813380411370975158675877234644056752342245067047222212243662746355130300122765231682254067026726793936663663850979653046056856799537651892093190586095848175774915375109771173568208316540795984581536437782023031494258033765177287552049909665859487066509218354077662097023112504320496731226976802279952702217798990308561607294398121994538554804825779546129893704561258394841816679007918193982407140181114185555871580912062798270238422352202348737749979193460762889122749496620883432710880473208594975042646898135353800414817301963978863599741710809613509540797515196491649364870849318683600336174382159445436165310807831923737522070980674445120455852045082525510622593532240786701540327353585406780212036652528586631575094638981200558291245965173576612577295663306376423411163518798632820708680271902230690006152336551466221813290239943997944790924971550179069658430244939125477734444296703411848198487266997749494796386640145874385813538585237594361104066964132234850244951756283250166854009460320679427646896072530767466081154944145857034751129244092617388266366115758774905917336936907561096833793983832960181012422776833022124063858978862059780686981743688021769661459824944375077682929458215292132798422530194850240029933260834697260375681150217537121490770691579049692728362004368911202163402122702363820193538932269636419669294444832743201910449836686355597935558721703247943883452699305258811193420082626494292491609396711942339697135626248214725359558265399474144140882082379960463997658703100689546044041204891337043606003542363122785786107830738332694950932282772784720401615888884787766053811300080603997247756424321157908617323866348403718505757111565532561071448093938089312978058846939719278574738846655983675878891068751369882687080545382810062289523374892964006127888280464700115293175062230505354664404859961929766081607180478852958539961580745378276382027413514590630602081920361564323713284823393985321251072472774138198145431080963058703994216602291835183161974062655355248409267070487729270833232042504269015671903744416507792899614614810028844936249850294738983465839522886481775685499990373087815628258319775668388385857952740388894217578360724970914180260950369458944551700388105426620089720448795057760107937954453403413893839838527503828883132228758871841351519183895034819163617352348396783962654311892366104119712687537433335240428253937954420413884739936454192414710088616622904152142005822322986267015195242897887833372925049770440221014494439950724068147835004693648902170337258473711865954345519961609814273903055967301542136502171275942334896856160255162770753504280120886428528175933086365931397506439759114109624181871873637956923573909149482591802232846742648575337872303640865007309896892192004508043559451403253780870228783888662054881208950495475264165672350552505634062782947246721472676767811452874256984543629273500885573488024931118971515522514863188929808753475255510050122053402097545121271742488239391311995109837468779525286132227343064600918087492223769552130938725755294704990481395907404086774621023877095584251712977696736332000683575365279075434442564090740673528111763174513551507522733817035933415644768790995679470081345696080348516518912171903110871634729647241912668497924836664753702481013354483149585257350670608527643724493589260419925760650697142982022401095386328986493695777980588058129679210056887260832204457960378276388811982165032658414536938283850740981052992081707628696642360929966223461188974195392208646115369326247607989588896886238397109805526017640485876789962756743402459417676910686264061097651750725468033425457318201982669158764669143968092597780150254907953224810579804935124452647424423741826786657015161358121710269075473375771304245839462292687990320359476323006783439313556640181786845523590728150788669329161713396189508602212959974741476724529472338141909836115043217305942254288818120629197173351110822987371758674877314073607643894446750543750327473539440419730983836873851550103185124835821163415654685334874212418379802282675337394785065640765095680817282770059685271551100653267653635005143628906218348029320856593581438876963234746861673405262531350489519539382593881022482022261862895464140846382940574526130411881106040609313634433751616531454136285762520524928242880557559113892643795078272121835317837374169047513925992407669518670033589946030447513223116445013528599858870717186122649324733658600707440605783491546921004595986163463914541464253695050558502359578484959226555566466058006077394118445921061266339710065500595074657477053029936611921026179643331694639676140253452779554044055879819649834284671174346660560543043998937916141070875321679954216552143139680915452438258024042264930112410595502906029924075314789955546780417316629828982640525844231081492059506967053387544874815382474867379462351443875357973337235679387585032029222862269797487337539676621968873820882117226649691354972965700504374837214951743156016623879280605530762423188962859035654438824426481445008472192290296204982798956485748317203799674301768552761000989590981747877513853411739008509564864870773009299345586638255720359243202234218998523832740918277253258951398432254699741066248348733054675706340259174543032234987059642588004590245917545420688552959306837045246782250335662409312424403810301559999734515590867997862666881347740204981327005586783058455110708462568188691024701467689143777018071632731466804530503837198463992950863817885774376842545390162682315991966622087178970769504266572553609676128211749468638543202007960413013603738689630293061791988859079833559241339492696005762457424477232981423411758285161437525570372453085683315316838104939482373212982314698785837983073609167680909013622511701365943451016509704695385428573899094504155435275147714454635814066758708440041893025505283364624798192779052833211921867083485531516112417852649436733182792263616061477685854775641284259838640756694231832991201903323546827162695022757650449975819505009334059527670058523145913946995807755204543867913734681853690137749375002618156504859720401776233519231450389114301221088941847655335789147870247130378360517299147089601984242765224153386512604335658215389519381516435851494987299550043797924385967320463983970108954960023134377449306726001378502246405463924316650334003651071367892544293987907539603710133266444702764205656233853937146708501464700025669815259494430961092938929733487398948082289822183585939459362117775928515226738058941530303554536046544780292243668626960154986248240104438372651031657724399660120409222648374654287211400070337904511413654720973036214386052045066652061397191555711253923676038125600385283555549746709692065108863689930928715732597718492045916313217838266276625473593206167197687654761815807344522761195859083267320605738271134818528741149763477290205364998915247057149220720940539224088947116347058799137135687777699022686940204925568581512971525984256125082533684519004450010614375000606888853523200446434097884696256429378738124243502057847233485899349100260654092942873487903924860165749695157450983530247646067745418990449213360795835302241591859519066425742200049056021030852824396511074578470683998638585494634392383094087592373421377665602699193782089988052487016374954997804798490516333179499945287329482140502548961552947377848567686162245665951452236735074081144845157655759828573315114955080028306878627487965753832494882177378150225293652794662248259862560162523627184377689531933206677999020632141502531319525486685265088153301392727802376270402810668904935157891658683494950460345603804071260111352660665018900294729463860691692549876675965261205516951448341233465747971088088781939537394008220633998015372715463376422069363845491999185566691338477444701280443186209914686704305524295386045993795194910434224696149447657206343838920046714250947321571581383677717395720345904432401907537579105268266127873115807093825756846794907948599458074315678483070639906364371556060976912719039944396724077556219100612309156834829222633771612593836217784546942200510963120187360108015593460714081762674030901538978608274422351034358973748007300228382879264664752608449970184658953655558697508171772945626183193356012639921890013299015513444722185893496353939216635598046786455810376137513608133932131149818983971840401231084264502976114241646025855795378141325676163836890850406679900187949435734300225947193817272228884385388924766632372623168175737316691955083830120385796218924297099657202630371443882375289232521730900810917555707326874978919526150466767288939903044492596222986151619092306859537631337760768209083056821297598978478732049876095895412487148825305790040502191296125159417578858287812868030870693061318261319132339112116547400093168095345372323974453348115480365511407041339101198633641379646767585519027161290092511065722025621295752103026080372312214605033265253372556534478094992050298871012630943802330804966732974630060052143970280339520520333071218938659238228670394522318375660649734320327206180071692065909501567358389399882143657469138169335151654444572533809003424363942955533932653546734060551019142562714522614438621163615506812405803992876301619955597241535375241262189933070691918098235697699274186075515213614541292469399510729048122783037990256804887852463341140862670144419761716829530277400948628451774560861741339899036166997989498455951278936097800594766336359030400573329909886295107590837726737152878837051738822853901280988315345224664277743267710469523203091175393290426625684107632313491344415351025665273836121548365940376868870852141716728084052330962738299305500142744838613458547312663742706715222649040325792744916863803519697792008400204611746791277438327937598161662648227011592347699609945117813106798889429224705888955757162126713920292833092310481607042712013198968170549307020643239013794355616807503678185648923510734817188255570319007902632208103455036101282334134624858650262720842931591681403540833080503910953943421198917373033568722275821959527144883440918806878441792202329283024476443325907251874070085526080004691791125487213247404338015296039191672172235806143868209590110058813342295652069273646355516703299210563604477216184156710312698375346359708085719768443170119735154840234035425255633566011078018001315856917837864737911855663259044045126256406468733735402756866182242412133201454471915552770924906566967021360184748363230538903222377094076549963464157307039622249550416762586779896300720072937963707112454150162409611169247894061359898809106532768017181681206698199703710041196698507158787749101595425848708612388585529517120688904190517611283361579404961488449191041633774059756962636036687268466581677465338091654434013015705096815849072367913208054776985553950424642195956594500460982751551667283016206207122790750605089384360726903315602079004589021037084342215447947357489528372227129326319370630329967207985355231172636826777007572212122788563084491828806120271525518449064225565406202337225218101959725669328036967782252532361619502739719022221493893751958387826994633652085810662527155714631590755287159556994756846540440881294477717973412375531861728543766089207148026270007304147533743653839906507116884025028095184520839746282208583977575877228836830814606120561501863064376952498428327367175924570398676997511931737753072002176280236857020049109464835505146244812885783327191200963393712069183045384482848674600505010507443060263486323876710021369619546864188917876181701475713801948106499633401242355066390339370481705528223485842034856154731523199228705065198425615162852450947122462857987225019740037925209459731395708076139784094404791399111419825930845036475088219129449968047015228424904558321883718130456931935282289780264745114121401295546737229653531094854005348469015076061730478108552459346727213536558174766883778699636106367894560914436387384490811833929234196319199661691994917708957234702646771008104414640427517594612496669815445997467500285085160610003282337996078882003650039869022876342795620255732755392200806867477070685908454454171229715868645758009538642836300621578007696004449836306639742091298047439325917974071975072520419180240255163445810805046549666431320616877193830123637001750067629550016940013355276899488187355544615714546184188768556488775313271363942648139325343608499286880179969475154546766432220724421736081567535855327338763569490479007960429857187337831732579285701835620507772989760480861248208950480992427198241105302169615928722610906000661071633200183929808058105854177371575838304552110617592284628663587773138149249703789571251175981026044664309977655667722383481124658542729081614616688618330214837301925867202114187521694304160227302794822192195509315146483506970299673690191456177512614395543154409346924295898078464430952347588158569015582028619868451904265302445611901103399229107713996617039737333253253149965069957207489603151352736839612926761281836619249093706411122552275264648196233128329460521740300905067545239066164425855141291214990866273141493679234273215177550662006398190036886671561472362053218037417837958371496059542693691091680379927542890572955909994299028102406639629824294497887672289521051374065737223152785009475405761064827883829362597521816061331459950860164628437688522924815756088843752304870968899690232213617921232955413361828211295941839343306231593892528699386654508310874743605284018812353323798879746268876941717818244791875754461707934459437679334751682834948999714541478575906766511365872440873108480929777995009837725679208061203082340255207211097030662344275343322584609334272069095114396855733346678686593300477668775879859380013529496181774801310547795053999875984726387184358987505981389723985309182875551979604406463869120722026465515477512178466912070131290857638836893512335536233207844671601666369016965261688863014990114653149820913807248741106734455694344471383862412098840874145772926466926136314929800839375041107633110655906477733066727725479948754882193959904922609066223568036931375124278667414116094213406134654146976827223625193104323128644177594034117331072568470589451404386759646007208934553292499481182881682141594676822161757025507425377598628855312938601619046170689066760559336737084949465233900506711950838100689724529891469921355104002986888183964908611228309698424329420145615664907714593656852595647325653895153614101901090281869675643533648000512077462158579973229101053539132960761355618398319032570070827931243184577791571649639459959160022856407037261064618847762821967947672555360101115569644323228105644026657198942379476479635579138025489633380342983200579241671226325885517877036280383205013991089785358902739387620840284550640523107909290994950404571273986383785177550598506833765093101550671264127440225654399018978282178298599891970583808479200761251851989665550342674620136786248888727387145589551905082360047156248295208727236916556331380876564263057625454992917739590704929943665847595990038081500167276664553459626990392092892802837341206131963855039128025399836345212228312682085425265794674487890760489766917131577656481941849108206404870718470295474735604572694053323688369229039978594083872614605573191735537427307841068337478950766468331152841302451946352260428684078092620032703813526498192818939162831865012675532413259723927236041656168646739088072443099387803910329443837463158386533716975624769669993816970244280318223735862776038227071403678746342377515220957948427527005547430526838627532806692539157857925224013861396060723172749214080631722055195915617688395493574271696543133045365728338702285733981965478436685359861850521795318285951495415316006973047532133311877311374811634165338943121610652915313578627951512377329411256255274417342453715474126743760719106653961150650104920888984497104464263241085956773793178310210524065152139543346877650349900364996691164972656066193040862146861587425095642646008213300241029759512169346594943171235750531551778229462339500205980782271166559095612316339810098909276458637147757136213921445741597156879297455591206238555866896275509132099631731216016562537973867133150051644337636293355240210517356935814112542759016542383232799033356743407179669499636299911974554410978940175269058273554386625595529873730466350868760587962553940047316027390589177935319749211573176405820595955489323612736514557235074222234579427479370249713275250481825667726102147010774278037582540753044318642588354240319055720351534761501942388720524857743456716847419604006756750815412808256939183095036656276371228968438242608330219450889755964246622699041544694826501068986545616775662145569477140188205972952335499273902889015747789037200476084376503031189317833302947220413880308675900630160369508560120500644004835372703937857409484529851937149073114312746480567135954795161494550273692246599563671226388020024509771593813496665035996997005162744911501730480909132143158258082719828929865046669324356337436943493278102243432572641259010522320354199400307913163806047256134793242265176590259710214896412294136219554059557562374174417285164478635213601473176096918809227950011384883364687966265063873287205014240217282489180706227536054689304540282095198361276129839558692848530268021137321198905675807134788658249469722176329087100213305229639640242365136109431849269467767902207572984227020407861607672816356327116574815569464054119903531385138263973612861798055060882672984845788528852270805740575921770561330927685330218365413832450731859785587628614574253751872981128316248724867808934950634219693982320702855374171393832783165274048757463269596446299808317888207774656053727947600805632079941283957977356721849004313775375372514519523387846822647085906391770204988847573752492322182381534047418635801540897271412084137974058876452392245003340959845555463427807868885215488200829744467944285722311829344297096883618092561428343473482267518387484413863882674031631955857193705782770341863843425985153460046417012047072998207958341501175019755026560260700533956058110989541295665886109082648953721784399340251302993015006161438350201164753208779772497932883864984963576768577859300895423633398267733640182627769968216897320002820642612624272182558614569463492032272569986588073672339268258629777254755703310159537525011693508907569629017682439893121935619647108661425326638901206083706920818902152090366688203667856057653121857586950693482446081842785556820413928858977875759765427402211019791607233836882305971625988699321245505976922793964929218801647450518952695582090321366841516732875028556559031183039246587043404940895014214438562378325610860426655502821476582146402387531918692154534004655271642809479197256284037850612310175653456546797196925798595052317491418881156271347365115980800764710573575970438705636905413551687997414803434273298844243409389430961012384964051341487022870981975045466069995343620150242083577993354193076181385153503347300336394997212468099438476327127562830250828621628178095306848328118865875639629445260237587717741256910981628616302222222581412271916134224761243699791955941371665377907671532859580576089033801815253338229934726089001472690455148405034904325659691911408853568654564997648968802306303382794038815871041753045693470590480037907203107176859437081968558542414164289265017377828825667737349256950983018153362953062040840874372680061814451000645325515702552526798625744625725371095034402407316625368563705126698923020599704361678012485533014795074980398665769639158254384226963913184160458565801205133188386184482843894187108777787426101225387879703690602567473816512335624372076379566082030679124392066202357586501478951661775358663857956303683405537847778137064029703926036747958458742089732052549318161396475554914563870886654597859221632902346903349715483184681178322285726314248667783155646060284645000051714558917199240164881090266136902573707212409831769690354034882497230519475241696380437678766772927785172291590256573518625192289399588469376105905697705415089600178032945914353201376915456322320250960867906195719699857021709433438207,
    5219283133417550597608921138394131714748003987111696388844721857021695621345566328693730284546120701185550350229748838662252951341253421746795073087191036889245882078365188808677470720357783212747307528673196680088458323693474572645646430349088271293578783855910006177172218945638975265804307407923864296665887203966818881644127188326278536823185302433682452220866505473927329966261635224705976307336848031449051946470250326355850564065070219415063390427891641945141848406032059956642759451697871131937435974734468812612404366795155477504403442852091868360651937341101803746125038414968100853875769649772568976533115626733686633581147178167854537374386645054536421581487787680673873260827329457946477205293076461503204195229898682736527831015184366661152864587615185846767471910458921833277044360716991019765678686642856418011096226793070226165298245200286805907696043158401359233205933894872270757840780311842993502030651236226420390626397948002732496153425437136287482563891064276318845679420730548518354628798521087698057831570193388325181647160191379350631674091897212262818278445060746814976957862342535407548922347134501697060190457417366250455037928704152728620313194049459090938561074166466321977154209854449604435530303555162486890044423150383891465784220859099339814855122982824292907630042351718406860216298441018976432899012907690738344741325809832514370637919675751564228983581067713001959082281741038000510382863445395122241581297039798297231129157645252235222643331292666424360475348246102972693436258291783024959062081981838812572142511803956525449888847112458483851365748838790507346393979150203170197392307844865039294565185258407625913055060713900922073408886771350586379576558646737634415678011238370510372009244595665266604273647744438936460505842615012921299723039609880229752363633215766432725435987253902189301146196983131735602940755230848663445117927665658368356420346865950111317140432850742151588086112978702994240762421583385188191350001231200565700667791389021354205858177467953946405058508219437914852128789874720946029689233060816869125386142828340576189232460988484979947357301166335302699325444851058733209447959819326191635260772935604990851134296788845298869594134244897534525730181304428393857426219940590672281276723518776582169544067334705480920742604001168622762198273693428380553897726338361872954339053214349828778842361781853106705246246112826667187778644452294726844594574918377285572198422309281050239527692661557089591842761278181057933278000401648351356081767219918593264919576995069142249170223836224702255068465253482078539098187443071918215944764927958379845359365240314888899686669959635761817082650578399550074453202478150863419553174171457756089567615842152519360157327308360698725072256365040969792621539584036465460483849963364877060077099462804508783747443748521994786797187208616764402042119167359653346884051067448362794008940082341100994444181614418213550484684610370257475208798374548203571375481853250719794707737297289106817344273543178234366780318872649407377187072730875789746785084870361011603837828596063380436934427559741399079630414229895319266149914612519280272823995869813896972841782561116929003166739744612062920048993540969166539567069660783098613110181470263393931915610974133757611745434282513504673223466819904565802892335444902334736162918420861856512137424964551732430578193645849344558708572144258113789862433670385490704828913699643122856631354937003427216841447763823770059461987956351233769350148968100975738387546952316818146789228505502633995283191008860757224878910306387822619841228487510959391915230081278738478964587060771579566927543809518001023256799064843500598047448092769672112496204842133809466280596134763991644871105523092033002144386358014252471014304933512315525855464929326002127213531185766066959495012425333202747713991260204270554711267603519448421573364790583464599414079092630562559049529970854068245838058972902782716657303398011079570340993681978602146016260731415392796070099302915857446184284492338184900216275081239194286014920899856256657301752101626142771298248388740363577822427523530496698324976089830267271770433302612928863492471906219529755857499316371756474544420059869354061575644223098201545184395439200495673217450313417117617847652221602698562899339244049925561342019071478094656156692298970839460894861033151782740390479827962701287562750064371964027625677232269761059437891312572243255115277459236700764735484999611933639503357777150911412524162248723431001175341571889620281950611889360490007342476142047713725454664181989231971490749598648207558524714435823528801963270106690871228191029010653103641813849875532556927413266316430858480756663121051354045742088249205913851178254507537826478453318305024009219910295626907315048440247469362688952564187604507596955998539879540191650667035389903303539491945912991638480371092660980900779331006985407097736196322796802626314674103633849922510328783478267810901914263565926331779841234341557171622225997181620978940634079517600724299703807480826218272492787987996449775919730062045133756639675098203801102844045509184301293110435898724583832877280053291902793566611159694010696228754063771664996095787812423235160254094397254125391108561499107218473169425539288882278513046714043407319219068949468172288158436366324718101955588003305237184455698919819573905719538347163800330464965350384709792997192244756941845904840558998378244156887880300448205407800127556895875369630084390234520371765003246158785015315017571785917762532744084067842701965827402808244353884339008814967552009585707585930199840219015697516779314043811604512416068649879615394713114751547609261771572859645987657096712479535823843294183064535902637275082610415092299017574941271253130505203786422599954246588012241306721923065806890956746479029456426379831947739549627656030524765928950331915786548762562328083171649815759067667516704588106333557929886109775405451970851524312228546878654197960754013026372859274195306213445266974071935007298641663616314033269884667955620111309575343217861185691394535706369722324626811632890909545866042361012706332668814574002886089482457047069792424592306019142598077930541370804870536746764718703756101315103402498751465888822984172394408820511781517872764205955480840803205483107196994531153451950583461658019927392514304980398554764126899265779300584663624849476060120748057077601917768935135399413692676935044564082114422782031238459636513796777783240689793652195084844112602537745301670926262492546259891100605861657849178159354817407487478931490801670084160896230614396947358808585239738180232916108965188695590452014440883246282331273025204280241388275626868589146434017242042021840309157931211813867467410616665884021235841658135804262812971569692978840911041081726688997548959744100838476816595900886448055145128729248758017622720446939441868806149463547490282358163060869321029448427336843444204243515131163997504195558101171711507769963992597654450780344736522510720458589263076972478692329843045248108600587281975177627285940306164121502635012077569268382618992424728960577293015052952673828205703560705531570968207693918162579001277852045222671248467264497211694624169858653954833760474356592813229626505890505354134635151787948216365327901508819411785142152833432627728196612826280426493418494354332715759068513275267431843575112419627392320363061901254840884481021434867813860576688519853931319751135758131820799087677142019115811990730366088825026705967895514998294919077502618682136729305438490581592513614486145775140327508036090571478743601469925100309139079297515952651542458232938433515373375950850550901991034330759166084076529135116217558488006169081262614724001416460184550734010510439401941574568085146192143492506415272776443357698527499205920188662762249868506706790255417996527667702229820002517515132500604313453961565148329696168408722070991415891197822983055527178331435752092793749578216888157239353475522775912927356042862965707543262449655486923996924705591337073224376318210126946003029950798609319746198936150871899457221884322874567454461496564928537222435306561085047593752078023600242671756689325995928149581875252520763579817026930285253426477336763345530568689085250180550154101605421383187700964376878757622750533373212825816132162211868283524579681634439593450986867763869643415251323936438759726268396342400872357875606140671113018462893096298958797589424541173503692724334748353008327094914861878511664919938546847178441862054576369254241418859359997673824895122765329123670077022738684049477623013354061028433153254934063535551741212284366260945270521912247754058217884488363961097022478341654879669119039422474711453560713897625651902545874268502591066142164065201145925431736206354259681236123782295953421146036233320706202542802046619108202210601905731146091245445382171357426106435391257241247454462347439843026848957008024971000728739612764701650820745557077521019023663558599300030098767733318296212267791898625397335732188623883018403444800160899513961282647304597132863167285590498796533476782410947610427209426752715165869523201813729432914018824665609813028365558164278232504560433356526239382675492262016251904662875264317012930368279881629876130193702623522145536349509128321152604697440779119762879148757698034629396659742679932515174448457818126556092989541554952290365028495230047528076275510817038546562525047710332555203233199920185022949987410470356466217859084515621715814744078133458401690440973632241126599062439131812445571831195750648033599093956943441851996548154573576590514545685636340512675499356488849184088303003552394888593264605119630946263677978036135351207949364007605467423376526619612619708816827290437234533145243193982617179538944195289996255922150763223450417133426698647254499958391012721079500439885784286798208974008103527525798997123332642177873443192384052822584344480513642088070178308582176337990887892534104789618366717917812438060665661167665404965586160176289888772605859421114049525300201228676436639481076283265730005578214880015011360655245823382454752145003922761176793176860917776210439643878167980131866355801604038300074595892903069711260374423051281344007558766331046287488860890165799881131335225761972320295123203858013644354191760983660411514591556087245015247095059134575699390131848115923393546207714885164019016901853980277478069412283251180591353065417541684186732481744926646830063532770223682901032098939874367730081608222995311565991349593473838913982760300921230171795098158732723221531830432950856290007606569936454419490342239200539463842248283452814424560739976630988284771270307905269366578858096343588951243106238857167947528386703433424496340998917553854024438991607375269389374913330083682670659443407860772695251623499496681365629776020551122942020147967701233170971164565472853581741935610647156261442384055202447461052756324428747528360646913527525663305805317605697845478025727444978208876304016703016714358509239681996268496084710105913501244180545330136150204618138276030314331596601730799483529675130449879705835640253303475624331762638560430115055607878412858576302603986169310524352365499033295536709243931053749941781216666676849722636559670195363085481243708523193553203468045286868687572241116457429815818493904095679641472113827308948644547480831048764793974598219440703597760450979730526784548348528478981126440100335589564511210080718338720668292455434033777745737329876314888817706542072502546494305848810503776519846387216503354243469167270879296292107216458214318938620321916242246419321692446400984188491107920927885540506689869333319550124121531961967637785140171734782180729355318808490350500625033283733486196374702998782686801906999697823374757576051529793966335783838480147339455936666307689959754516238886484633922071530920738265836010765063579426399950855264177745045360357798058459894165283550388823443191581207989394041699662793780547315971739049404334692755294151636293340145938553396184505733191406711054032381118628275046047882209953569468206198402245769816997661783644787630668623255824944069180939286643322416802183432233004319271910928887103445885987503538865217204903661862802860195870304417691385203611714502909568732628386772288321101737981952503908657510268626233956746929677891343398693108833172456699933150924423772966255944302389807107679885786647357304745578601085057960865716938291990517461346949345588040786702324417668600590221394530822148873687230167938390325669700283394317526993044736683267934127199505163235323859199411955121008904060213692888039563072698548205248121582170609366676650613275568505188142341951040544825408567652588518558585906517079389070196584208638012431962769864845935249042575015105851544443130170041766567612163646516289495143859625803124769550214130927323677706000126547367711187358932033441900785783804522154484942994157381726864957796374317989124569595601718921105964163751627872221731073259057071671114748468089122507573108262957947467318792776413329324126543145101325421150794742401365275910113372357193932014729097560576009796970589125132018505242435049021999190501788022198184026497465786915101220787507788225473024214784688957422903036584053396565930862638025590443803676419182052755763247523593787911111805458919102073103089396698803580832272305421557256437585106474206596838008830418989029710524037994857577266645231673510146636159675360017287419793516512154770352296551724089267870934698157466371337582272478646002708199948393973530096606317370926740805647404584433338728747758787449799483214725657610666333689585296497210167818951260851947688849515831641598466707355270906108846342509978285495939770115709354671057029584411551950522223690988001144258550273342538920445248869080701571113838148084007434013046317661547673470938239992648254419143712021487373234721473431991119240737093415252683167731028644293446183013582418288512964757209870743934472061672081647165005618387786132070667312550890485505403716544778872192898136970375010274357427081353375089376782143678081963907852958319626245972043515519964702779613588349712822541044839786471769356045279301841071830155320088747687777679036500221131503499979504575800139618953991070532853066560299227796553133876492788471387931546473614682116573648894401928950676697741655042663160432049093844423771487564784140078212230826253199064718726442268863914621131705728934425922395324963886584520126767794172859617162078663860451891957154839984407506434112876487007685201545638383474365134030372400663301518149134174638959201138045043800404284330813643848642446512698685902193797912679197289529539539521449810714442565198278216365455011915421576258652895730215900302374917580018053651570992106524489590657900587570625744379186519421488520877903999425363706741239465560275250037105968752819708824658441551336227303560387773930367130490497737191158528370720480058629520189288387537450696844122530346385463324853957538538851116972967092999704879118387132854330328107827693937467287347538274594902731750244394464490197158501231457149736399183870541715899012829219207981459949070532694275286603818617396937996420009899103467474958498036633243200853183286600971353965870623674945011038720236579523799590804766006303206878480096490186884063849257660694003423814016730899173658625753071641084366116314733298531659941798174164443634526932808426209736448529423480715074538236051281356370205557298537804473520654085821963484446213447093493478105436390068371505767925883351873517238268285535258153641140173662913456752338996439694947459295909147107537308689499566226198769034114271441514924367202736600421291624626185612691833660991367335133933654955867668171632815842871816078544099135459253981792139261130052057679273911020068865592888176034404772670409620548469870812571242224766785903597368375801740705093657243994581280287940391862903474036903047520272297974628936388853144078848752869911250165499502068388850141263761703550768959086097423353432540696692709809622981960562366641400485907192259570580297159789983018699762191288261917134227355803146407182277730848943505098284684041046525667958811928772384811052101237341231033701944375149189914793181092191086396866352334748449769231395635567602908214466139766841051481060326459152770437486389005272441707123755307243210430531732049068456449825816806929054541919639401470321710848514620892330591633550185766036860943234581259615801049107411151644671751101708383202164583986339558524487030803831599546653763421487059629455443224227763350548492160495112475253019491484247273334953981051246738563060559894847220100004561228283032663663490607024016762521772414059741405138019007589458785491351732514198581173710128958313941112314580263851166875856301200483439518868872555780218919671127410917048448654558133796680189124421049177485066749163860074544198930562352634858744568269433666369070064786744129288067330503196284249790618086683008925426583395932006123930513722216691405542976461576026663694155384806250863078586676024022532674700237232099790022638523214039980502078812635646671328978030000908199777004485283855464685557392854298946097263278796029029961820226986513291912643982774325100751655317537416095015757565889337111322486974074849380906325640899329823738483073861429628431453876727125004662470132712133930125059635927596905880616217949752457825440734336306740027529307085515497399778432231317434153722079091833009196835600565804017627356689466438397325852365287526877981067745783317426861460181565818435176585563553263968772882565448961613374975233510610270510643855817864951332096384347681579804133304412738579769371697995736436783801260965236316121819658236938848772963092662966740383338170368504160178690538808181150207965829454043970734605092665203282180306998737108740832392018885366175510813263906162171005118202219769546450218933629837449315986873995014879164622028047281551856288025869366226377962913079159223152980479974082188868134816820741028507402946930810315225846318849761982037990066600742078985463760789106179824322081072404870576639155178597387895741078337970325011843427140903118912861728232683648500345589286390175032466675195084882765161130942389193657015081427997289345223523148674977428470938294436264427377992263874282907014732045997521204039060022970634867936562050371836147130070902356551551316667000212465890035317022959564724972037608536949462213866438499643572609436856201172162249098182377970815406162324050253705846134150989653354393374265505371966391919009566402477187481459454261412338219115016224152566657471830602849081762507889894286772740319563048102338426499339934988291650899581977816703568304505456412329805350562463820858908729713680280814714554636119382888658716766350039873582718858924117791327355333060161513935413057383024626266388104235168826332573188570849559945315731231480139024165079490103997398738515187430543249422093761887076959636534766976657766190468183508532583690193944749450489143056996156898388636551440241518490912419187703156009441384697748060593244163827938361962226484334594535539173840754798551270516667050496731065869507321920919270878338465956919689177567361370314710280030473826043672826789413194236074292601814069920257625928283832406785075494703228337816044689608816258562393204100895940889180970760107109380326213421017610476805064077669496648922573499327690724180178120388273960987627968879558583043095376705550199191021286378462589686405293702483227357466451253247376011216255490247352656747435617419406346634947543340002158660581492596821313105549952810516800577681304284116785753044174476706869021994353640048589565581924137759347425774607724917148319421422687770421201675030116537294507236323292313150944942750893948610209118785264533823896568610555711575854192944536266330714967100611360624738995194581459406070820894872744466524729935157031492175464468567870881582761271097372624220434628657735130065084550092388586761683200773265886960960452490687027022830049586277869226263630175237158843534292291003883133850812783183100571495765339152432314167957221029138565573829899302195290825772526183743964173790228611192501654082144891830346172659991051381408141257105960177336986084842925975783181859299822502665565744896999350400858755053409643775663357955071862663255836966922465364032900847592329183798408398517577465125941098264076255091992180073626578203277086816138537028294667401704649912771028983643381623990666129099900254845625598466469369682697049039433896514622229694939511660434043154654341126565779759367902111555908911005947707963951247660462106373039251507912255600650920348835192689776594379488819932909742973567973593682776666511083338402742981058837811878150559799568134485601106754399153655680390181079011143615717606599353069113138221769583848263405849978711261082149814528219311655215231477674291680352723643693723563267709046427605981346289180013778059340540079409045640365842128981588669726980929890449590897770770717662756557321818635408920540448197962358293946973145169436334222382843495671076759497044546060643800127428205900283277440700839560328910569409904424449283012770825521878522632024245620547645717447254379107155964792664126225184844373849325631505412119004097493480791410583383081107888281419099235779383229680188384017779292617921370922372983282503298791017021921784715440301789087148507824536335557675207298935023348409468791607206887572163473596233634095514588426193776677103790030103697798488340857651485831498976810338247798891274171430792711417218119018685594870181189724154993802014008520621181498724733019671519274815607394471144930910973953871874677234320837673786173747996926108182160592819930285028243565270434019143599764939825434835631361977378834574498476196067276279197970185482513387075992762031284719426518736333645560539947459083154992047508021177432253410186114503046573992891136350397906727213151063042796603505508078503029848207956861976168707326309643927627932082478629958930389043300695953852245762426688198844500968552103443945388825434581952086254624804849323094655174896563225863492656231228848145999054507558064876783575233406881642671081875445728176973719623510405841272435458186174137551447332986198005631148179254729286590093654809867706726135218368269085682415849010927074017886271791094281967768009321122158979102288222564043650174535214025103753469650857266570607612767932187496888032409095242429364768509011462430863422253155131799344313616840024345057582809274140558256227759257581371536142332899517951052968071988191897884803413540626817984476492395370547098850219684882276641367409472540871594231816700092552991708816738672526158318251399000404719419039203630576102697834973314012448002803604296275826739467016237569391742822931453251705873513636865215811264417093048041562413771425101516307271586711402176333163244449446241366835142172999167198149195445076785771746105830099899755240514179074130483590748328925726169836229219135059115543674794729764757528954732301547753091360598364488144583854075666742799233901477793810708349408436623037613251688464857600837871310874599660539329826527399852230164943162201693782771653469751274562245118306884929923560792884211974942868001005426031939457512370244462812148016201342630473074456267159549293867053767659038056779949088426976254034728077254088135636860477186686146460626899902745613278153691400038339669537740544826562443805626535786384898572485701425917432386986347545005288812481364181536338248364278398726496016692123724237943548545828896728213046892088065007581346307309209881633136251506534455849280057342437035243462095729482589560053307406095527385109856353586250293946996179453801457868107800325660554532815889874967288747905456479104063078963446408392211991919068709916650366427193521435598108874243805361630829273485118140255826064152007353462362585456695582483253258528935582247912293014030259075488692057966145622502275707411579967571940743724826280576348051831482225559303226913313273222907950041784172300547498749060305878597291391606248972363355290948450836366255126157308403661054075454235785998143321284840030323563674035582184135793969720132762184242168341237392013032814153508891929231249031814578555987148412261004467680021274080915281269245527358835933371407227532308886439039983468705220620776921285207515612726428375426237913651622946234427409596825985581043754174115704264121004641271992679265413033893641001624386885626557671648182297944501373983864934057502341197478541199763789436638185843621570691204086149963373213056836154420869373597108314030426861451170412906079361626709359071741472975878756611036628962564131510773383998510774234687088992540536801810312009857409980694442074071368789046025521655489144964103881538946439359229988944312506134360805262745863808061869660883874870254525608385737401649750056276841658403694887805329366370830594546417565156055684539618472323821222897413937507741026226089596583549804469233405511618762392692059158528940278631113978465479265717747579601226777431147475637428062537631976626723681685522162724527759014616906930247421641947237717892852919071511473334229604683532898578628709926886572101867418845888405030606641737680827364610079316942421258233285125320063076534522312971471190655386105932096367520442927148501744391319945868134556799101897247505920799352053517687463088862122452649397230334908938410526023688356915746631269692332001052996469934456965145092274742595090221896958122113128807070503152302237929958117399858228931530449344428061096653254595757996596012868178203613096503557726524712340939850503491212011915661283110007772667503178059477499819303182705335332834624459158622179543934574194844832941235410788824896970294171227029654839529716920953122839133725722885792046979734701368899651860091368672457694068705142153704665956590116443066776198119837317198038690756679423778649983031717953241414565639804415349200132200388959885387334859365611381421757473594124140300845948165657326321402045526457877175261783902945741916463141522561420203700933323680476307717876485388538676825388861848354773776158304137581932840046496698754994538681513128446619105733675593860631122275044806365964738480695283198893795471985032076312138217279280685956908551225895651949636997717323872407213019526947214106014685651896720810620041619457350403927319816530507040458205468686881230845683976768482406242102360072859068637840237080897680414672874457279137290351731285361826730747132309723457291984363054662169783469965067810677272716989229549869544997643420048951962117330583406227256546424931564492817317988500941141515774213641259043678844901192292384108515150131680045281832808388783271580422344334093295411984846535779091842904018189972599953261108377814593515723506074528068379258018331670636324449650928795940284933846400055459917356112116335784979086949945956369581741604812238482252014218364035269595199869272652197509591599816699129577988601552450772600803111730257689434740396645678128683234080110444791146574502596759538726267567009665497064869837428440984372682405795705294960282556025175630442242188965858646033509764922752662123652688977422399818270845289060360558386646605078985503263150878101365939532848349218710579326324704979570885404956464093057902572550952611083546856831967686482879514544641366849189646088116922576717467199925666186734857012684711404619122222064933395604978601744611743951113455953556328610156977263958739929187328674786548136811449687282949959464723918992516804733474011918958194431485725908061897509325645763342150537353562047224435251469859024539544189504439300849183351131681465155500713348848128795541773814600838142333161455411590379382669821711558360682069527214815090496728243251582786643214565620855793063391148893746148386079869990725018691105346934009990519445508612266631423508661251265674502497598756950398610432628407748730127550466119774356165205370842865986184667867735553498989258556008873856154427543324162434290854221385621825103918209962411496521118503100393801218804498094335898100551174651127818634061508921345797071094228891630661197651503176297804083407503387958738779823231728054874323709008933134448624438426846944206222892217386031225046088111368006652541888421175452254177582653499369929651138600800741027340620230487986645086949202737931216665994821930610870313709126952399737132540385309975814913154995423990139861558072123394602975459760316483377007587771825828734693080155411845165392580769408122778403721414643069282531176939619244341314801506617973949652070744757191107303628412599066986095533824720205929364949877803945229268870501245351146940626053304178852435521047034575113667734617754500661963818241921208808397380702506120671386228596514804976192096364433057894515026542453389519706976703667448822190555676718700117911969937613026278777664685898739837320198293385475856981545160467595781051059780865926310684871742256366073970371133315571897122174711575709464736881167901286125630981315652760228531501360562481714702756523436424625827221912993808147277963411976521259544076749554395312420787932593342283316285195016299514530112793605661009694234819494848120085316782419587272850426169597578713913838119633794226240972136103757985813472492983733417625435292871433706976344722792941015783853475353343652708407894358944520772289898872674742740484848339023165449701135009722248795133268731580400777616995446938112267988973386493287027448125279191613549280379125833943633785510826843274216751522821192213364520504701441736524853373673052775993304466331746228693662454820127855966813344427298724428725099997883815935895069759266742277754452785223198225395420126605324413921784656592350591352564504974300115154753203724700562601048897858864627332306107639009429847348705213685734646779666270739036757264798706366717082817778569182345581632626889029804301732837440846709600095468860501877676107363490475302176894215736152697335549229452050423251959642216005712351909883737110650640462571917763261363644073123974043524360604898099425172889556529695558739041335141026988248048451686410941948124137851414856210522426849851233491932732885967027530009056057402771477463563238426347491158563391282193749698317202444556006834819749453954930404948709142513769790815924782193134271436422848089193949751296635731423357305077059680607286683946238768086916583204287837660863511834993728933593808937204730088504695966202855914649160950495261084680473425111737346349089985911777231516870873939177555617687920936211839656465933603741490983524784059822082904379182908646050311226555221525131353718590197929076527523296879814974636095717173139423128292926745910753622348037564706386621357860725673799893777383372393100111289659123976786185291639121811380109387605587417307703776842374480742015933414250423785034404998958032376121677351175947202529445445936401420825684528930433252944659624845238478412682964290794197831339041628289280961253295881492994833187677795657247184627306823031754751592427656240090519326492351411153855659203497653462770140468613285037394262078538365518225127559150816567130846249692140367467726431422359675640846252299768341260198868569774664974070091355790173618477171135158031965745221288778483338621173773028791022498552695770080528271231903603215854033182673677732390815788923291201535547863632447795360680745410104801549274631814955304414156023001230861971851434410767058331813577376627313754621707570235149793939169583495718558280422601398926136081916186955960444642957309945276924310364925382102688860755193232624742167899507748620875816486118194585172223522356546049903369154893081468084918202273499880423009423734442043442694934267899815854723901445461547805887439744897656866467087013666776411222956145372700199126267175839336354697272954222295918286846413156648851519834374935146754481915258661178319472647102971415994832283713206319621947821269223645603105450532514841665948015197296250963551144435401390468397855102373334213221118521208171197843587891059348455545037263508688267131949763073780308342035220698921760014114069597372773230214821135322470353203957525649770669877565941375280100373163475862528264915280311167525218394152080634184302889791962473579970683141581471367167366398823859033794514373537111820368570242834580684092034921486224811443675327825350442872215580087814400790012284032893430901019879204063101926784770326535783846811529051794156407477187456890340466432830589923960026722742149184270686318060077977380394275787685722401626576051886422849376510886640359204410603860752477917290151466704245358220930544452648689125784308911759593267785772940089830329201292694811210391594173316339596562858769040282000587564934571203658346546405901077095655346497964058797249584413213202466300584026658522430836645691796402536511023785188368038263793065285747473834067395416528863125144331209051730445172788920025966144945622750727071769079507716188347244949699706258134052274553137262087312709718464178196050537438923956944269088448615730140394291854648304518460320125944437200877090952384451980339029248077677303351618474563787853633449012806063571691919714073305893533618678943338276923320031837250014518352089679990940060604580188868126181823515089965208831121909774681600755207102403082769222517881229388340462909419478821493296594574233267938694393658576591717632521049235386262891417365005921683706006284478099570816690996105865157573451865316909883613381642675289627644828615531318743459872161460363137442976038994898964975630432955663939378214779188148425633156064943513557006413191010833856272339131999107769951621083465515007,
    5127402762693207238127857636203402218800465862270699268312403841858231274305620361077749499092908732125557093200451596185805491533791569813459934004301403420963876503051395931102015314923539804274582396743992807950474719225956493549755113731084255868197796918434581937598237719449693830758295558527988434483984402926845375042397676916772484150646410917772519028191260065794740179769324698367726983862151189703959842488900061272076024459112340878109546457346491554143925842685145949023067551546771775954793260432752945481806098802929000907427445042956652440017686821739642342283937834042844291309099347969102747457019190141964862487369125287232304120180671718300574342513576699411857774313395067287653074850588324937103408282413195256438383787207278963764217585989297652130376043003743753738855745090992464814545996050643193581313404735505484589430723093798823359856272522668336385259952677756552856551289009892928585351817997597030498514888896397853351107117298797441034194477559304372109097290724770947530415951652971238902317815917038680603767679621050951143780665933783692044966565073528785267030895450902209416549087515755497095539312904309522657662573379910237333667849079849220423840762884973739500200127298974934830066840393158838988914961956695510930546945980827951096112962664643335992487280560134900886679764181190584527535596309993103344029282425364639953156663544682107454804931256238955533113496018816854182195543330531080906323445078316250967348939638518364397769154256659856173480003883657206670525805339385205102031809817585314840602972682019418846238655285164004752145812574629347496147187860255836399547712572271763652225900724547782484635289547426451805759385599266973889795734232290479220332115891609768156288342457935909120914007323909196438381794326456768293490507645188049139856490695855921347239667106058599730403070475897761777384876428450587345819993007719724539699098055541679729873655504576709009905603259030920627958993042266397424051597783360050334896922727141271478699045082152228027176387242258926795536797468085134528625106976095345191577913476371028410646742037674051628455878000216377265397452084015240867090868867221753597264076182115949014522094557935332115678514099817970329091688526234719385466559494653373537899003323166107149478877117006392742932314559290084835777094667606029780458934036386976039274781268555844995512614964439932924940312848333645844887797516295800024064774185402159078978805168601770447303316431713617130234794350541866792806893003400689202963176470263352023062089730876527043230463014879144521952661217703677799441187657662973384737966402581038747961045995695691052348543766640499372261445442597160606259053966068732511151005174297931072476442070654725728997312468606997496262806957417754746116751611888607847520118238695988605632005765040116452483003738222108883182645400927748375991851316480041378139797501430225910917778283739088610331481527007155171810533856350046610519043759763735287608317720758292043647836090336580690160570305468673327908088769346820644202222370805567789924652533710283013623161521566452434952081959455776793645596433449191241875779804568888134130384052737038581482023245957727102774269790268483623397849877307665566360077642424686431521362331535538625236147207010477726452714608576639216929513668408452625607706353883532950870370035801874995812813451432008448947266393601762979801361580687909591815579389477766834753251940287557801066551722677979963148412466936942280873277595719690771325214856788811424035793433963398993331031119441383882955389390151657476397193836314471258409404667849604708290823276044211968110911567811341262080360778790865947551395744817070583824061150098445032835197917407298691261013378898653579321522078640368048070984501086794395042330782390396751845471525030920057416168578236420486622426378767586883883893489433813011353455573101221128384406545741394033581094437631769412130294661724106175181125398050027695112993430023630323675490992939496504744805578635472179788333768200664819607284340917322755531869709230020828192538563016722363953568715031024807326998142181473135798116619125308672912530256683199051480596855619122644251686812232521133402619669222585668465906911136832572514562009274392880973584373798361547406479432084329403349301000394827230213855184882751071528067261670154680072053788815282747410574737453703637563630570435117628195978573859441739021314639609194570617468380964312984898051015808531249520173981451879164999414743675749804234774729611723419052649393703587908248649035483760388377673954593219972520460512648135037493641716623026507566948568177612501099277675842019773333090894923829100110076309867969151081052588982607951865471213313183245060597002272693110245785965527572016217588182180611542407587567815731154265933832507231884099577591490145058574363430855132369561744047149760935326046633080596172554087268798000846691309970043155701905733040446549921630716557714857851435295738244739711179222259227248795100488126594739221835603749600314934633344076353028287578586024598839126822069713101750598474670812758693292659161828026166950346748815143463334704542176784521435388672817578619278494672228806465126368945625182069538753150748681827976974516834491919682447499595479376473830053931431014725195530345010374265299332489104132410271977780102176440834625446012866665347194485014498192213906712461571558461856215544094243315778552512002140950670825241426485599659881554353612591403867412422460776539555531219070870630305526323467724773070119652811134935638289746292798229378856888363134940926708114880619599116394578819044020532468981521819176025207014749161838288323149490258523875175248280151699750221467024407911729970497221734109043858511965549018877943198319459589401737280330407518862630051588881613569562108842459004760199605403801598397565491823651148326901400520661066194241035982518345069096793618981282457558427497482957008675010720183774437435785017575700492736626204612419206706507710961635642170205274550473597511836675925420381368309015709938935891601621321760036916411311681516123297874975915480198703078663419458804402864305516787820345985693428927205941604062174961545371679212308834552826121715932392540107379577154361826818491137529526738049383903575651855103642326413630121139155484164888243377500163407233045622466976800124271944950319285079471209642615721698927302762004348567984609484332582529312222882172855754718970819602949196772520214463094595900354649955409789175317792173269967890029142271205494449345217873671282295612587729305103999979929743481579369070622515827110227043311618627937047489237015082734016466143123088742374780178674664214517749524379311269583238249276515231135759218285766054677815440082858362452031356522322619464971908751741399920517485355931154276760453082651439938324557659678759861325499804190722614943694407186007001553845676121681900718551500159385916394847105209050635766728229026717159686536605911843649165365766883524827564881177864241764581029132488129076507527512109503449158438453841719282138558162521299327913862781561956545791246753034127861941934167249886926595445327450131322517713770179490444309917949174257635990272618937449595783818693095466417625685161064435326999391106015899511235037207338465950393219711649816456256986656953206680202126257859098323891799580888242623952863477848461113235288921659445319444746539372174714266551926011086784963086727886600049141566177960851388542791184157027436634765810258245167882057584625826946220598415098031006728731057036482791782676668744498636690294917146323352239119119476127803088758287801924080759106903028128733032620998436991415227372083907001140386625144776473334616537497811627351317161766754152755629183578965914057612778898616333253680076989723132963096267843619665840738100891818504497613087480563689696696325338836257752848769059556895155023387467272471217438559297270422443240859193295885964922612907992528516329523860022414077126468190350115675704262996712924555738506087065654538334187094265197591237263839877125045316352683284056878031458951849362713050864416334897199315211131857408980069888681660777681538146464853672307318157467335972918696262359877612191264299497306856928716507175880622392842467165074998385165181483505794499544813906347343204942924289137256184514880018273066432726277577180260746800779269938881910307323820603929380479529421876015049476691320986699695942115897568483208244791979519901240375000591195016765017126144548505799030998701713970033915814767773118132358804291265033958409755369127853957231962590141743461569536779749634235639798353619572450258847759459694846905994477525156339273246913346759956744990111496334981805905230802041004715927427344647936927755876493290124167078164505345564766348558129462609116510782224937228880155892729769415562471445769931140855391511378624368263540127686675911547708352109818175644039011369749565858372812300689854048247048805169051527318082276479596762887555775088256570118179705331031761747334969615950377366798311061069015611318792118651480632269394796274992601445529601919756015744946861111012022886714161161147773931868702869884490852860743828823027319235368138865992343266288790246372010312873917433718997957513043906163604361465060634386474748537582400730530159722940939826048191605429270124336981275770338138973577616593971621833582360317980144298665533115957141788600721470250658181066937770192408683344698511389924513540955385986068357670703852792679139167249304583680796643416358600440520072280863038081592154544270747037715498851168475607560611138963966888983656284449171233326631216377400660806120540386444244638323057376171601637971899649659721093999368390685082260546366837300067443401507588760007711224203876302325977304818038603718630000255840302557459495179075549363582840354987790643328502714368104435259086032784633219981950714288365275795169344442417986953571445084667257645779903420686950035236373635997797241784433641752393914137341953392759771435249910732345729142592917959066205535292598448687723249119889046284453689168476265364011033941647276971920839364592580134373888421503390706541131854336458868715573463168468946708115745948272813055299026592675592731439680121153957337008007647968358998074825384885748671959019983494738049779807377977051152964806091449794192972501083985674996443156468519126946644957077909219434127902644367394435341912828719668752255166985852553507368074481199419067623767369591212873473594202232044156174331473080967941594806472553707555012331113745212709589763955361919122882011304686676910655457379868999971589191216488216541751852793814911404750535949300187484925837437651804785616959019881309984056548806270456116453370405219435372547595942601365146441580538057855431620125447486124780099894230652448279396782565238739301707121850930983800079628678351299301787704456611541537321343947537106101351193195936343602930122992360748087753981993233084344411733223639183219773778074034559366785608989524181683442408953819324520906940637386858403198020701662889681076874975308719004149166109223719368525619529510261110807516307297190175845962110555630052985302651462511656729849223504148650490706856711635074888335701589478377973269819398739998660727569675811617042408102778253624533207908630722333533136304860833953319141187521024046533785992713775724685202401271073708088556714121800183245352292241659738392664307495545997772995421658041288321200093552375824141717731884343636997601717440017201377429209130214217269181591888763203788884971870727424396746714711131361876200606993333760112725521182626737279646463631025145546255189465091442357976493837002361956919255834452242703305696768456187304448790007617613844578849663616871475131850204590577091027335977696875263844896997340942208281171440084942987470051070820569697809935528409206580581607716209090646554078181617114977629081540094839829501444013894578773866686079597383370192985336761729608733878631238593635368417417374881263553568889305307888189572488525337141762186719515574461226838677147108083491660413827052755050586106089116938160069477667723155199373925302340373549874172842390854711784841049290196888419132584703452626866057692381247929148657227857819802319538730633607454535685288705442980644771846584674510901124420706904089276343102916739950132888330209491220733889504205668830523919420976615490747594150327561032110977923585557947297345330773277531184439891775723764406464342485914416226166364694249554479287406623303522282581319216588937074375846411966905513860037153323322768929484050085524914484099663072396144466278534349846122524839944931607623607928908867919931011893838000365036674585505157797293416527639758415131263874026878221837674217823597295757639756335103814510257672715794434384633052687849789385892570677414345734175030422842519440702505760307742190422275627347238543460900216879636996989556428360118111998085431123774452854194395028445348594789007015764392608154412173386561671417077425392837274630896454817187748285048389574310730089929036737448134777095875585574516422081878258837443867710221930271840446455849884515717983251647725876969636912734850443435164346055033917516879631881271065620961264741404822095026362667332682185875364598125213616764953676101127681164288062133420309585789995219186241470797423391634213701830108682237186526491146808990228632983011212126242739170016294559949113413729541382740831559822863555356273751098038633680013128660871853820189342366024553248314451160677818203027334549291235216566847593735407141681888075496634171117541075264390666154171915183768102309568085715466031561760559193169183847770680748160024719617594042164298308850480956705556130577080764636389115122851488596840790111460370614861106491856731687957173056637121307923137394812714467970656785303199480369106290685075964452923238317355791932993212169480061725978070236115335240264266619442608348761729139966228197947621412458121818261366535187484801871758603078959673472550852239251049417056007219534821681352241405278386673200132642769954604824753375525332171011827229027485291404780578605204091710542469776515619500478949781826013371842116881908954391880977808266898271437171222799405411220215124006193981134465424386388514479139577993094752553950490748505910554576569031891925771090501147497594818927053935402002458054741587143409260726965960497642217918689714450184025085894395564067691997209773798735834130547270880177285121216131841314094971410791315730368766539549297867018145889086472470418843802065910159436478296208944120024165178018299849011692869626363429989884067672619117200954976010545718563777178411908517397923976244923144100403219599437704117440463734109281098448912475340720340765084931951146971856131734035685753112106983202648800746821338642298597351573168341944332049367210957576797292230250422788252297593130535812079513511857793706745510711688963473953815018563233128202280984168557302045451514098025859347390439076058918375892950703352687236643245081282470938563903788051753220214621017761154534219477943282771708164383363942150445814460815273018859224049434778463835564525614731379156935264534052399107389748317220917723962187042585637902676099779681343315586041988654576797590005713777635747705766048956047167864210244365611122529830187277258068103824913666385901198916611173662251645959804995219050845228071552673078439537490650755684972833045676193672558210066774476131851891393648190501139776531536810515005442074916415468874055835769896673562682217599658026991924624441652350908785301948627693734467992778137887844418259628199243814720799268305773986688580678378788396840506637125723442834562808913921468834672194550581480470866976802769670917833891420666355989549293274445922282980966757946143453996245344251567096725883299323244172602737239870789343028278268708575986883090609998824653415906820291573388953754375759087922687948606607755581853829585311702535820987848900759639772476078514212708117780908640744397057580907683989541620562196551875902368717453133782329596713779211371556412416610555650785062634085118672208488655147743406157729923150158390249202696746329681647740899734646173725445978270403430177119697266024540074986111456598238572170495974076889943809623971112960493513344390202181647996298985317086564687579882771785452948170323378468555454973229500301429827026978668014786309970560025780805972658866028473107898264331484367737684871316172119935309665901532295565911998796748977682150922965823378100567223289118785765041815858235128342824730451005370040821553134610259143034466531370479229075789197225114699710399735369890803816484641095300209053937180251444510466085026473928413349140845751190224484462062291833120232242119827413671527908234705284888232043409394504783728124551995427411382252398344638404161387902290179640195259493820427439930436949232927913412896077530229885037745294521476358038334182604126998658614415992797224390651531982694721302911841754380652121290041981182190641805621797038759903157777354250158550478140622451354393422822228576476061565487646550051732231043601217317976467181357312227540968393187561451253054789431744109734388447074377997628391442589712472842282496599855559594053131455716784391889958235924552124300523898607969317745545631160431353766417164227418766893320532256866734917630326252918291838905455016191584020146682530755163011902032819311309960095804246873510424584264096394699306670088013299076548538799973032145999136840782737011647657200888292792583275393644507756794465510998538320702787950865745704435557581732180066358676587336001088308072635841068793487992957731712602027373353956185468182032224148187974219776973615768075194975248907215260342147612699739640393935436190556969120878158357207895100853613987110133684459899486435623503745387799866299211102498028639148246432225992647405793335082423709256861876941610775317675133601150846659691926749923242738391469711159116336381915434424593014185114830017352541943311618935141791223901422259427838815907539432477614692381022944287306481176714620559009987830221259930624711672848003254859888710758406079962719178597728385829287328450105358942454471326496858171508760959037213633731926200466920495722994212284028000190751610599489876728366432841413993713650041386286765432469503718837950951571618882635770007155160313424849952286962952302904613085507681699282139359444705942995593019794309575508960795147337061359050565541865101793073038144874012765895974004081670571880097267086490066932356937441408800921761738915793270737169601644359173050007391399659705319944823320155135839490332700221547710738576021725700131597007211117915549173435084366029939187723140956398380080427798898797352946386430787204027994744397402811604775451118611474910269713051908084167669775944986011822680218291951261995876080342404819648137906879686707610972347150947814892260373597006195059478367088616245054986544969060283562691836797999331842501233430292058158566839352574814518624103868713810439750115467493230228612128575796307856946987822510338299271775422112471459416496340824380091406572347358127670883626316161870987168837437685071525250057715566983806993021021849909356128273394072107305646500011543871515388589185188274160422952303793732183481970154108997599287760243459465491906227204893657437131035734149495145221216328677575132194333446506345667176631215597620974834695637041743205155548733588100793788247206562741596735771079053326488979348054445699333806531340854298532422890121033686305427486377248424968995883123309583150447612825641936514136488908778662766665824162614285103851772757696117639944501847050739916190214328621840190238246049508716853672375722757539768184851565580349105881928023221584608563306808385742748297643746416576917013326835257160065833397054130274017870411302466098844864093835645252585026807153455939500056376797862231835612418791883257336882676544376991698892130054280747742764052613525727171592256114277216950416230082742613712666340597840453139536368149689850910830069213431355758086557065006361770564081111164406953318424427410344140141460372152570305387961548218181071652365192024389178544283337290644090110283717189809141306059691254328992864801660180750117065905723199839527715193240846977823544000075351368449911457369486365806585041421809662307727333352943270127454014650325140746827456414064952153607161802846013128422257793801728856210698051081608034556943203047881069109053166384829740583454965339080759855170685346856480458987088597471636271804061065678921986595548413991651983946479326358551307994846261116056906207076921789833793641085769938066992097138660245522369376362224530810707486604715910514835913440555702891614082341854686142785069296533109321661225583724367822116167355882981412380358232203344001198178674960193227194755857798104606263983590133102347320015993729308169918831021669177474017210922549809286899167718990197028764355130709168795292807275154892799928244718867246314359846113067759657209021825749265213618474869485027239088496489779227967047551206757423473883708398795322689888647500008070075773397018123204976257629745438133140435189863995238900348165010219457406111693593877160314340342503291950314803953383900933766805117123870849563197973607706904863219606125289675353238108885970756071955719063645320389823277627450941118299149736138057789438801615873813219580294061643754205701374228422493436724019602375986540846029626807601650697014732075281502733749492829189126580991950968920829446429776554938216435443667446122303572380834008875806340387258562089875690132134331844910322908793759539285036832837329602020159758375540313165102621792857184862098566269622648235974494388899955132715506548050406514563860948386730660673732917195444122946938666126451981442676509468600035335830106854615934206381258964326546632992670438836692311645980886579939856286384418158270062548942913120553573604058011673221575559744067473786602038850956613023213508010712157577360948973018604688450618991663239437817965294994048608042694240987149006834600971876727642863217693014151675544809258104365525453763570094549910041525044381930998851004347271426922795095018746532529426694858747324226586896367368454510276829527700894763084602086670507305016587563210647156683642216763749725214855616926217755354729722628921211227356488692447147114118683338122905327242007737947886307968922188310926100073553389362887211136940985148907175639648535268601906904436440829058007283841598871951769800017561623140578817319387968271309600971313614204008888997905484661557968388774162337359120890682582551196882082609682649560862041743676347162480819627616148737659396928054539800570795324360373126697059079847681963709140179399715093941981297320544181702000604656831768094383342026265342355112248052813792877679448920633195607207963302654961442325652308384793884759082143251167653201646246643637143862312828400666681979213848005965292589906793098783883551113058842301140585958002320204217922778391891207080626233962106893946358585168117675317289380934126349504615308452475980002444815584766117088314522552264788917355046642446034005982911164852865260130758721567195663065061892861998840280452035967538328514547198462642647107464185469981703940773278555290966031304945320116490166188526741221755819700815668331357646358653342391375567525955659676319717963687335641290620104348571872207365407845623105045972052990918978887058535838041196115104315915915195706888527789998582871600790742661656398056712409624169047960506988653384330924477755197856564796555800631824829684751937205975481744201715219072954876403580459288543840836121093346033950474739603268899591460360358978555598527025766909458633822943206403572439684659265234327367979568792867116515445746634935861794700811693393539219427233775225002041203728954053066389335510524480643511356365779713861263281034983206492765939840956387846384828606382400961985772657057528419637494535124501629492220657374181071548528752623113826029232854341389273772333319324917938530732756647048463899619461947350750615334425264414973770726745660296789157598990895218245078905144209608158294083153020269873478289243378270016506323189355099352165726255120210967458098692281676680845667259403539975857666392587556580540633943645052742802964773043400364057874697235587183178682571096440248304986510725580349657520465293619901953866394544015885860283067567133877840981225786204403320196385903895277967094807553513005747133125296061202114811182021802692708123145551565614037048488863907368155791360686228406915673919152126431251891728550603420418822621002802382001181068136211287973016133579100374511377754112183979439460117010625462731791365710608707233364409558878258559560271989274759245667018966444799843933411838359271896265324881705107022673193100246756729502107378219671573396006717290327248961844134358992677946471401260413751480310381424925275214567958294630811315585631585510012730450881793826682820765394336932233653373828686133168214759008463787036514959198108600947279806034341610753507674802670725790641716537440251821873198169281896088926526028742749940505645770773753362873956929810082732218354544200805458102033021046914281690642704923706092723028966609631506023252375439255456288252117541321471507562876105154285080355527148289452130955525158164424082028101790693796729301830143804148626460826561494718059331073043181693231033610044855674330355805026052725055920874727148060338623069741293943298256990503220686771738366912806459427212127384664995994019293953930788786178545674814809294962848711978633164198912777299190547831468951276579704066408950915400824842697890175604992063337994107458920144080557304990379219391918486597529997707933850546138180568384080200684556356993560235668817638583666024759384802695277050036320431673107398871251171577396682141242768269823140256115508880691498163457084801604098724265897940276501224436106029903402312708187676029323022239824025092817664586906926485980851856898518129581404708939735178732633894732624611879072906974539801649300044955107508098181900045149142311352439798244276931544059064333985786237067602587927333115887774081435129867915326819023230458906075384635596318973567605463150190079273843289684118858556037112546972758239375813849739149421461118491687971653633051930669362771000783987166058623159052423441849732062023986844391600713820348035590820190870669749587118005514010633050224555292880722764224389633339168109749548065272413153392133516012504126961520487664067372531532766914432502141896463595345991517932258905809592044262980676124517747680825218707595288624667114506705017553252613954594422750063258665272399010780930581742731180230303457146132846157049174709338950532721507730383905854210117538711849328951748295866047496785983411644185352883548074539342728948153620321461328607665747678058813011433711582209368981230794434220074268607662117174168339017936278695570560772202420820270939079159474627940350296914741248028272201571834695762959632772067424745696242592018843404897154782747460396763999200173057476972239971745935224807536090656350156484146190760102300669961465720776262096733126404794234629555840697756095532019076073984599569723866266216985519262039857550536981689337777763139434492073739933219594931123873145357436286605569997025677933266748155177527498611247861224791236201541466423658853840170229304252551041261898915687504234943082125689802109298098422338637450707308246238547575408993705952345389511696281558829575098584334914061206871103300620824741482996863817471523088441528456118083718072284972992580633805779583718894675341461828083442099384570882012994900700651994240722296022097485865075021157872052697914727351829909629830573732117236353934093600919199212363000454202747629226211262513548142896303220055286175796328640390695017100292379755053635251574742869449632188334377704089061424621732942228119408764395455351692021181462696912861155028148673525261822956306039849479255751124086613447907279189108206447370905796098627213778607050571284416539210210136479323870287538359489767507304417189349050145360616647134157763876215569234970198187442796422152279591551545003025472718989681022472833409388131116952573376140331474485809446658490429378562397613028703937942296701460133659138796188682641865294137760753206622874122366777428849338209915117659776003404889454991493772124976920074427061127920873156525797475431340917946047203382625717139323358437834083053178611638692459899247845870703110845430641930968707655107535599992770323868313026620440463991542402854153124351608973909148655543318773765808990711489993823658747308292435497266219120320537490746323294139203401144420915527544961163184200011688461943598942809528010433518391682499362611009070719074444546884952386706495166265426810077384119572142737013670181688227631651268847910110027594360263796302118678944440930868499771944818604720697414184352292875032316817359209496671786808297855407125447075903151638257069956630298086267751764955483038308044166275701170036735768572567719207964772834224545044972350894648155887838448419331731190434351733636234172116946423136988993648417944578030831938948721343313037054126564900675363079731943532033245942181203960853408284809092630520740724321607775887713001423026851705500458169365369642845177624487869288952001764911005005737511051433241938404667169214122751022327951246422985081790284327716059891907909512379657622799626816574021401348002754244981900237598506469991269354345293308346312779442404732961037135236870771883563613556254299905328910471459552198363636654235008066887705351119568226802190853759076666506079645385011573186633037606941854157939262437804970884802683784190808360886479186348379389892155400610659969844572888872567174753444363634040846731032989752557217103548883830302135942112865570067881183348927808678548700601054086749252214883795863939899209472702533868544857014705674893932843371468884725628834663726428657789535809785184593930867049837667564427772505089827749029700107095354100646416249923588567830290525927570180838506647803987770721553148449073730463152546276823936042880473369459153311368107791787656580039666566452186211898425011541357663276957580907464328667338729608042956061813650505622912605461239629756259662441951919279233274670171216984524344601396937289160318997763274962300819968033504107396205800553462116146510176250416826699377058115710350859415885623245034611000287783849758178421476442115817060963415606722581089259831315431264049806346339743965329111093290513621560743354285861616915972856298400586508130229288838842723956727150404603519915967334842012663312646417209586931207544143040017803650054775188772591843326008849159574965753461182557783116266448136033469890564045961721824740381418547002729588360728104245034400695976457924408400001158219354527464521527206764133196037441403921278832624601461112267125309159931776234572979482114338985819564574429305381453290167988885750920484971056850434139692244745590821544515378070148835486352052114656125596770851717365127822318261668377180426030779171150083972118179380130994461635807463668956385929007088166329310684388814278225967478540306537123809859500796391130215327960890891558168371664713547558350064552789796874564695144920578995493137502980473909467243887442611132247938853686048160727977690671132917286824877746713309966009823891246163424809223845424841763923355524521191928278429608370213407980729637177178369601852186139885235217412059166026596190486033925878317771593472590650822303213414772870177705984509102220973349834001384426686135009682324917071975642465820709473526917956595982554553267108280096299628956996192108146272759400505646929000743922043490355778948726289561205839963580847736489090850887742828490075042661565305180104163564976628769873551385385884943379991519592690961047183225493042110143864560780489778907145299804692105384034373548858828997143565504902290729247935832983124432348474935174954809372486748024991288149314886915439184678435716810621012223962465471062201735666803637339844618103072964813898402971368058921490309439612464119158935167919298761155899018910992412904198769344818262834555816882815428623158360993283676237940137510498386097144443575894880325984989602490300949101722286684277176448655218962891101463381473269931688155327750771485018970333522997254896570882927943668929863140819541118634592137048161802871355200982835047780663038122016063593041132089197122283226183128238255369509079847301190466459977277767468958394211977507761670595850176987682312331993944042601921304285845068244436474582089863974200639852256510985719351764767834242251278317215738581517293395290118078469503847952233153054518298109190574521437889171913381138083832047325947821461208756251104824288549148536663254924807884600027250768514005435284372096831678814734633674405473643965922899495093564671966549590084491520039432927940090850724606722165854478905974376064341042740354095485833535070467727823697345845984182516403677394736230730120198006424340791374713897973705318245703921648822843246551222503602575846803140959991599795013789395136968803402791902190836957722371516235298116828993351588249181636895617220416408329089887122096651528395077024749587210045140473823085195392919871858890308628862473856517011710077103831628571862501843405853078050022001798413660541940906022810908619981962969220131817538538459364450349651870362815323380487973898860505277007077382111101654026745715544225102755466782354183823105570339334706701662744085487261699963434905517661438288185620642152155604891926968981594702179901971130277668383972279329565695545555459894351080341571395152968684104136478997601405980712829107098261108846711871289678973244215239378360360028811120390740423415502625054676577416789626349787778079252659824740421576211385862462477828042292050203945698759939720788579549286046258564324960019763580949741599550306995694564304239815475986562440691863372008222591499394204390292288188085137558644011446684322904395924941761938457580849532062256847940999756296742957456574275604145061028094367704701905739719904296103925267995764397834642065909450309320915767728694463217833809369679130103979917841532921256153527522430739593987022981971342533337635877709833317302649962400219833904009853194700858904326776981262392457790375314420107703969973421417494974835547745568592013609976739162581150136125684678655851023214739505143843756770955035968683975803020435278224695079339823623392824459891678831769497237710572041182046697476910041679098480085674462342940391300728147597132452266456066761635430639321503494491981573236310143698881878873442212652748447779883255777153233432496542717898806391507602669569687520054231063023083067611030647954113074544307777936200527974484374392140892757479684210010912211473575835168148830301881697254523029148536109516782064769502922661798393238555105683400441294583754589214652103528631278730887820902899709668722417608442618722120774728336460428932365025168080511160598143181160927637067220934667673553056064366673344720620966691860907262599768539252877840848671019812602762343259784922153240250653282922685980584219506925061990975681213068365481871723163145283397740266776569320880699371703385332158394333940214674039277780519329602571060531363182299350183275999986860461243063418212241632160965532251316972060853999805809281994731415075060331827573369773978564701616990608446940568966889243151533431539177374216208553848967623189510874603928814259502748067445029979507017602987428350275471689040129019627696139234813642860348959185773128873428714959905456403820142414055222290572423638033485499050085363416765805412607906660948202608800301999410873759459792636275196804846806599255982285974542577401010879032606880163621708920602884997610204125559659894512560953948042869009552030978404650129171356899054263131269851460124836991457415735186296986041194577515702140842544833475181060231442773043788561562271636649958242971431341718280331965631363481066974819220940268180108285160832577877867472808569928456233162062677321222866076380695701306952427128932720022050643944425719193413868536412515009048386223072337307412369317793972653087053817074826368595009243324228922134282750412959760308058678082671976669091605917108557402533190203343169955383247338287373835967885648542134373713959573258314745788330997473576678389077894882772004384556949871363846882415658360674475897457828012916636334688515255541722870451152586484849928085364587535006790032879468766968546329018681988691955382814962191957682385074607837846528902841792316908277854741022093177224804006494974169055119576276769406602188907331925745235614223344870969855548164283420902612776574520848285249039145726717343124064188888210752714869289301000762617566038222560131326368874713825813740793415066256467539968825565493175916237620087707295645784340760402157683606569215223047792041352194782848210472599768691089988463056435326791508775235598431688332661312833175067721293505273093872707203392326953366943765627911902812836479905563681158843622677701168470851330464767702823477220972578048975012840729693368021220938198212197854467947606164958319337271779470291835870843005831723559357892056391064396275529394619559038356060878508879699396819210545043070911919085901748607666094521090876573601334082725264896082245897735264781248898450913756231649315068990064506351034984308245942019629997091101283106483669936210997189384071811866892697481544129484276807983748023269822507500502256558605123231529389565164955452460990530479438724801657860874598697834189991031706473529729247978486006279609348905304722303241864150178128207690735431555841639536570364592068609222085550855804357159395012987321194572782287747214558347385634080980451016674113371379812398977743757285530305860727452370630509948103057606136656482488603336701328018966694283214469998569096051463982923667553117314734211405917844507572113178131988478355486497583223190745542628484861307908433324102395544462765576695753382657060109684388168533854843123532916493949034155551677833850158236514152254231863754982662444409808829498994182604188406999278708777308068451599127473163430161908430844949344982234650104632462325937497602990738942741286686070820840548053506540171059384312484580917154953005791231115622362084050027871767502291120255511244823489873907257034428973839366017742208945864573428759903820145742758012853018494026897772047628029576610745074745952354612605330736606068308136989028916302785248644505847087332346917714959523977991026965389696016649425230489789492762503600391795734146395657570883119168159085594882185103559650094357375435895600569912753723726788607584528787599533733320544654874118020699528582090778402272110381619547102754712481739335383322543372212354258932557914960695881262005280004648997375393749696228415149386182687221683383343209925915204993964262910036605937014097444618151977818958898647908946939651817174012068666961943388185129162470637404257970502847854135225572794958947911158716562577443070262059523073743762096654319399642264752530867234620203170488627305412588443026036026063257769868204384295693510347027855901781477166577959058790387692172277188231994125770974490388398785326225913964134982043700815183454226573711808270509952995146304460446653486541488554915001004069010993070316659690874639503986678637053903714976947122308423231212024533432412834408124923550895122969460509023003374826662750699491224356244524729603078144465758271288304432686017537606032976431307211850708947254130783687660383444486397721495782031679977411565556602637191977338996093380256007239191321437760222890768195903217013139093662855578322852915441187402103433397948432487855398833009401724765419165472827998786320429102945424906196584785499513217711273013288607348012368268493279260403717058658594894184249773083050086907542750133834325374971854459957071292324415418615247764010289010968218504079233099853896500493695766781105016035501363245886524315224394046975356744436046151396433184206484240783585709902306172138491398542760432741212755677381153053892561883906376602193683236736730822711678956149432532644153240796400485109329883378631644703566339852138578455730061311,
  ]
  
  # first 2000 primes
  @primes [
    2, 3, 5, 7, 11, 13, 17, 19, 23, 29,
    31, 37, 41, 43, 47, 53, 59, 61, 67, 71,
    73, 79, 83, 89, 97, 101, 103, 107, 109, 113,
    127, 131, 137, 139, 149, 151, 157, 163, 167, 173,
    179, 181, 191, 193, 197, 199, 211, 223, 227, 229,
    233, 239, 241, 251, 257, 263, 269, 271, 277, 281,
    283, 293, 307, 311, 313, 317, 331, 337, 347, 349,
    353, 359, 367, 373, 379, 383, 389, 397, 401, 409,
    419, 421, 431, 433, 439, 443, 449, 457, 461, 463,
    467, 479, 487, 491, 499, 503, 509, 521, 523, 541,
    547, 557, 563, 569, 571, 577, 587, 593, 599, 601,
    607, 613, 617, 619, 631, 641, 643, 647, 653, 659,
    661, 673, 677, 683, 691, 701, 709, 719, 727, 733,
    739, 743, 751, 757, 761, 769, 773, 787, 797, 809,
    811, 821, 823, 827, 829, 839, 853, 857, 859, 863,
    877, 881, 883, 887, 907, 911, 919, 929, 937, 941,
    947, 953, 967, 971, 977, 983, 991, 997, 1009, 1013,
    1019, 1021, 1031, 1033, 1039, 1049, 1051, 1061, 1063, 1069,
    1087, 1091, 1093, 1097, 1103, 1109, 1117, 1123, 1129, 1151,
    1153, 1163, 1171, 1181, 1187, 1193, 1201, 1213, 1217, 1223,
    1229, 1231, 1237, 1249, 1259, 1277, 1279, 1283, 1289, 1291,
    1297, 1301, 1303, 1307, 1319, 1321, 1327, 1361, 1367, 1373,
    1381, 1399, 1409, 1423, 1427, 1429, 1433, 1439, 1447, 1451,
    1453, 1459, 1471, 1481, 1483, 1487, 1489, 1493, 1499, 1511,
    1523, 1531, 1543, 1549, 1553, 1559, 1567, 1571, 1579, 1583,
    1597, 1601, 1607, 1609, 1613, 1619, 1621, 1627, 1637, 1657,
    1663, 1667, 1669, 1693, 1697, 1699, 1709, 1721, 1723, 1733,
    1741, 1747, 1753, 1759, 1777, 1783, 1787, 1789, 1801, 1811,
    1823, 1831, 1847, 1861, 1867, 1871, 1873, 1877, 1879, 1889,
    1901, 1907, 1913, 1931, 1933, 1949, 1951, 1973, 1979, 1987,
    1993, 1997, 1999, 2003, 2011, 2017, 2027, 2029, 2039, 2053,
    2063, 2069, 2081, 2083, 2087, 2089, 2099, 2111, 2113, 2129,
    2131, 2137, 2141, 2143, 2153, 2161, 2179, 2203, 2207, 2213,
    2221, 2237, 2239, 2243, 2251, 2267, 2269, 2273, 2281, 2287,
    2293, 2297, 2309, 2311, 2333, 2339, 2341, 2347, 2351, 2357,
    2371, 2377, 2381, 2383, 2389, 2393, 2399, 2411, 2417, 2423,
    2437, 2441, 2447, 2459, 2467, 2473, 2477, 2503, 2521, 2531,
    2539, 2543, 2549, 2551, 2557, 2579, 2591, 2593, 2609, 2617,
    2621, 2633, 2647, 2657, 2659, 2663, 2671, 2677, 2683, 2687,
    2689, 2693, 2699, 2707, 2711, 2713, 2719, 2729, 2731, 2741,
    2749, 2753, 2767, 2777, 2789, 2791, 2797, 2801, 2803, 2819,
    2833, 2837, 2843, 2851, 2857, 2861, 2879, 2887, 2897, 2903,
    2909, 2917, 2927, 2939, 2953, 2957, 2963, 2969, 2971, 2999,
    3001, 3011, 3019, 3023, 3037, 3041, 3049, 3061, 3067, 3079,
    3083, 3089, 3109, 3119, 3121, 3137, 3163, 3167, 3169, 3181,
    3187, 3191, 3203, 3209, 3217, 3221, 3229, 3251, 3253, 3257,
    3259, 3271, 3299, 3301, 3307, 3313, 3319, 3323, 3329, 3331,
    3343, 3347, 3359, 3361, 3371, 3373, 3389, 3391, 3407, 3413,
    3433, 3449, 3457, 3461, 3463, 3467, 3469, 3491, 3499, 3511,
    3517, 3527, 3529, 3533, 3539, 3541, 3547, 3557, 3559, 3571, # first 500
    3581, 3583, 3593, 3607, 3613, 3617, 3623, 3631, 3637, 3643, 3659, 3671, 3673,
    3677, 3691, 3697, 3701, 3709, 3719, 3727, 3733, 3739, 3761, 3767, 3769, 3779,
    3793, 3797, 3803, 3821, 3823, 3833, 3847, 3851, 3853, 3863, 3877, 3881, 3889,
    3907, 3911, 3917, 3919, 3923, 3929, 3931, 3943, 3947, 3967, 3989, 4001, 4003,
    4007, 4013, 4019, 4021, 4027, 4049, 4051, 4057, 4073, 4079, 4091, 4093, 4099,
    4111, 4127, 4129, 4133, 4139, 4153, 4157, 4159, 4177, 4201, 4211, 4217, 4219,
    4229, 4231, 4241, 4243, 4253, 4259, 4261, 4271, 4273, 4283, 4289, 4297, 4327,
    4337, 4339, 4349, 4357, 4363, 4373, 4391, 4397, 4409, 4421, 4423, 4441, 4447,
    4451, 4457, 4463, 4481, 4483, 4493, 4507, 4513, 4517, 4519, 4523, 4547, 4549,
    4561, 4567, 4583, 4591, 4597, 4603, 4621, 4637, 4639, 4643, 4649, 4651, 4657,
    4663, 4673, 4679, 4691, 4703, 4721, 4723, 4729, 4733, 4751, 4759, 4783, 4787,
    4789, 4793, 4799, 4801, 4813, 4817, 4831, 4861, 4871, 4877, 4889, 4903, 4909,
    4919, 4931, 4933, 4937, 4943, 4951, 4957, 4967, 4969, 4973, 4987, 4993, 4999,
    5003, 5009, 5011, 5021, 5023, 5039, 5051, 5059, 5077, 5081, 5087, 5099, 5101,
    5107, 5113, 5119, 5147, 5153, 5167, 5171, 5179, 5189, 5197, 5209, 5227, 5231,
    5233, 5237, 5261, 5273, 5279, 5281, 5297, 5303, 5309, 5323, 5333, 5347, 5351,
    5381, 5387, 5393, 5399, 5407, 5413, 5417, 5419, 5431, 5437, 5441, 5443, 5449,
    5471, 5477, 5479, 5483, 5501, 5503, 5507, 5519, 5521, 5527, 5531, 5557, 5563,
    5569, 5573, 5581, 5591, 5623, 5639, 5641, 5647, 5651, 5653, 5657, 5659, 5669,
    5683, 5689, 5693, 5701, 5711, 5717, 5737, 5741, 5743, 5749, 5779, 5783, 5791,
    5801, 5807, 5813, 5821, 5827, 5839, 5843, 5849, 5851, 5857, 5861, 5867, 5869,
    5879, 5881, 5897, 5903, 5923, 5927, 5939, 5953, 5981, 5987, 6007, 6011, 6029,
    6037, 6043, 6047, 6053, 6067, 6073, 6079, 6089, 6091, 6101, 6113, 6121, 6131,
    6133, 6143, 6151, 6163, 6173, 6197, 6199, 6203, 6211, 6217, 6221, 6229, 6247,
    6257, 6263, 6269, 6271, 6277, 6287, 6299, 6301, 6311, 6317, 6323, 6329, 6337,
    6343, 6353, 6359, 6361, 6367, 6373, 6379, 6389, 6397, 6421, 6427, 6449, 6451,
    6469, 6473, 6481, 6491, 6521, 6529, 6547, 6551, 6553, 6563, 6569, 6571, 6577,
    6581, 6599, 6607, 6619, 6637, 6653, 6659, 6661, 6673, 6679, 6689, 6691, 6701,
    6703, 6709, 6719, 6733, 6737, 6761, 6763, 6779, 6781, 6791, 6793, 6803, 6823,
    6827, 6829, 6833, 6841, 6857, 6863, 6869, 6871, 6883, 6899, 6907, 6911, 6917,
    6947, 6949, 6959, 6961, 6967, 6971, 6977, 6983, 6991, 6997, 7001, 7013, 7019,
    7027, 7039, 7043, 7057, 7069, 7079, 7103, 7109, 7121, 7127, 7129, 7151, 7159,
    7177, 7187, 7193, 7207, 7211, 7213, 7219, 7229, 7237, 7243, 7247, 7253, 7283,
    7297, 7307, 7309, 7321, 7331, 7333, 7349, 7351, 7369, 7393, 7411, 7417, 7433,
    7451, 7457, 7459, 7477, 7481, 7487, 7489, 7499, 7507, 7517, 7523, 7529, 7537,
    7541, 7547, 7549, 7559, 7561, 7573, 7577, 7583, 7589, 7591, 7603, 7607, 7621,
    7639, 7643, 7649, 7669, 7673, 7681, 7687, 7691, 7699, 7703, 7717, 7723, 7727,
    7741, 7753, 7757, 7759, 7789, 7793, 7817, 7823, 7829, 7841, 7853, 7867, 7873,
    7877, 7879, 7883, 7901, 7907, 7919, # first 1,000
    7927, 7933, 7937, 7949, 7951, 7963, 7993, 8009, 8011, 8017, 8039, 8053, 8059,
    8069, 8081, 8087, 8089, 8093, 8101, 8111, 8117, 8123, 8147, 8161, 8167, 8171,
    8179, 8191, 8209, 8219, 8221, 8231, 8233, 8237, 8243, 8263, 8269, 8273, 8287,
    8291, 8293, 8297, 8311, 8317, 8329, 8353, 8363, 8369, 8377, 8387, 8389, 8419,
    8423, 8429, 8431, 8443, 8447, 8461, 8467, 8501, 8513, 8521, 8527, 8537, 8539,
    8543, 8563, 8573, 8581, 8597, 8599, 8609, 8623, 8627, 8629, 8641, 8647, 8663,
    8669, 8677, 8681, 8689, 8693, 8699, 8707, 8713, 8719, 8731, 8737, 8741, 8747,
    8753, 8761, 8779, 8783, 8803, 8807, 8819, 8821, 8831, 8837, 8839, 8849, 8861,
    8863, 8867, 8887, 8893, 8923, 8929, 8933, 8941, 8951, 8963, 8969, 8971, 8999,
    9001, 9007, 9011, 9013, 9029, 9041, 9043, 9049, 9059, 9067, 9091, 9103, 9109,
    9127, 9133, 9137, 9151, 9157, 9161, 9173, 9181, 9187, 9199, 9203, 9209, 9221,
    9227, 9239, 9241, 9257, 9277, 9281, 9283, 9293, 9311, 9319, 9323, 9337, 9341,
    9343, 9349, 9371, 9377, 9391, 9397, 9403, 9413, 9419, 9421, 9431, 9433, 9437,
    9439, 9461, 9463, 9467, 9473, 9479, 9491, 9497, 9511, 9521, 9533, 9539, 9547,
    9551, 9587, 9601, 9613, 9619, 9623, 9629, 9631, 9643, 9649, 9661, 9677, 9679,
    9689, 9697, 9719, 9721, 9733, 9739, 9743, 9749, 9767, 9769, 9781, 9787, 9791,
    9803, 9811, 9817, 9829, 9833, 9839, 9851, 9857, 9859, 9871, 9883, 9887, 9901,
    9907, 9923, 9929, 9931, 9941, 9949, 9967, 9973, 10007, 10009, 10037, 10039,
    10061, 10067, 10069, 10079, 10091, 10093, 10099, 10103, 10111, 10133, 10139,
    10141, 10151, 10159, 10163, 10169, 10177, 10181, 10193, 10211, 10223, 10243,
    10247, 10253, 10259, 10267, 10271, 10273, 10289, 10301, 10303, 10313, 10321,
    10331, 10333, 10337, 10343, 10357, 10369, 10391, 10399, 10427, 10429, 10433,
    10453, 10457, 10459, 10463, 10477, 10487, 10499, 10501, 10513, 10529, 10531,
    10559, 10567, 10589, 10597, 10601, 10607, 10613, 10627, 10631, 10639, 10651,
    10657, 10663, 10667, 10687, 10691, 10709, 10711, 10723, 10729, 10733, 10739,
    10753, 10771, 10781, 10789, 10799, 10831, 10837, 10847, 10853, 10859, 10861,
    10867, 10883, 10889, 10891, 10903, 10909, 10937, 10939, 10949, 10957, 10973,
    10979, 10987, 10993, 11003, 11027, 11047, 11057, 11059, 11069, 11071, 11083,
    11087, 11093, 11113, 11117, 11119, 11131, 11149, 11159, 11161, 11171, 11173,
    11177, 11197, 11213, 11239, 11243, 11251, 11257, 11261, 11273, 11279, 11287,
    11299, 11311, 11317, 11321, 11329, 11351, 11353, 11369, 11383, 11393, 11399,
    11411, 11423, 11437, 11443, 11447, 11467, 11471, 11483, 11489, 11491, 11497,
    11503, 11519, 11527, 11549, 11551, 11579, 11587, 11593, 11597, 11617, 11621,
    11633, 11657, 11677, 11681, 11689, 11699, 11701, 11717, 11719, 11731, 11743,
    11777, 11779, 11783, 11789, 11801, 11807, 11813, 11821, 11827, 11831, 11833,
    11839, 11863, 11867, 11887, 11897, 11903, 11909, 11923, 11927, 11933, 11939,
    11941, 11953, 11959, 11969, 11971, 11981, 11987, 12007, 12011, 12037, 12041,
    12043, 12049, 12071, 12073, 12097, 12101, 12107, 12109, 12113, 12119, 12143,
    12149, 12157, 12161, 12163, 12197, 12203, 12211, 12227, 12239, 12241, 12251,
    12253, 12263, 12269, 12277, 12281, 12289, 12301, 12323, 12329, 12343, 12347,
    12373, 12377, 12379, 12391, 12401, 12409, 12413, 12421, 12433, 12437, 12451,
    12457, 12473, 12479, 12487, 12491, 12497, 12503, 12511, 12517, 12527, 12539,
    12541, 12547, 12553, 12569, 12577, 12583, 12589, 12601, 12611, 12613, 12619,
    12637, 12641, 12647, 12653, 12659, 12671, 12689, 12697, 12703, 12713, 12721,
    12739, 12743, 12757, 12763, 12781, 12791, 12799, 12809, 12821, 12823, 12829,
    12841, 12853, 12889, 12893, 12899, 12907, 12911, 12917, 12919, 12923, 12941,
    12953, 12959, 12967, 12973, 12979, 12983, 13001, 13003, 13007, 13009, 13033,
    13037, 13043, 13049, 13063, 13093, 13099, 13103, 13109, 13121, 13127, 13147,
    13151, 13159, 13163, 13171, 13177, 13183, 13187, 13217, 13219, 13229, 13241,
    13249, 13259, 13267, 13291, 13297, 13309, 13313, 13327, 13331, 13337, 13339,
    13367, 13381, 13397, 13399, 13411, 13417, 13421, 13441, 13451, 13457, 13463,
    13469, 13477, 13487, 13499, 13513, 13523, 13537, 13553, 13567, 13577, 13591,
    13597, 13613, 13619, 13627, 13633, 13649, 13669, 13679, 13681, 13687, 13691,
    13693, 13697, 13709, 13711, 13721, 13723, 13729, 13751, 13757, 13759, 13763,
    13781, 13789, 13799, 13807, 13829, 13831, 13841, 13859, 13873, 13877, 13879,
    13883, 13901, 13903, 13907, 13913, 13921, 13931, 13933, 13963, 13967, 13997,
    13999, 14009, 14011, 14029, 14033, 14051, 14057, 14071, 14081, 14083, 14087,
    14107, 14143, 14149, 14153, 14159, 14173, 14177, 14197, 14207, 14221, 14243,
    14249, 14251, 14281, 14293, 14303, 14321, 14323, 14327, 14341, 14347, 14369,
    14387, 14389, 14401, 14407, 14411, 14419, 14423, 14431, 14437, 14447, 14449,
    14461, 14479, 14489, 14503, 14519, 14533, 14537, 14543, 14549, 14551, 14557,
    14561, 14563, 14591, 14593, 14621, 14627, 14629, 14633, 14639, 14653, 14657,
    14669, 14683, 14699, 14713, 14717, 14723, 14731, 14737, 14741, 14747, 14753,
    14759, 14767, 14771, 14779, 14783, 14797, 14813, 14821, 14827, 14831, 14843,
    14851, 14867, 14869, 14879, 14887, 14891, 14897, 14923, 14929, 14939, 14947,
    14951, 14957, 14969, 14983, 15013, 15017, 15031, 15053, 15061, 15073, 15077,
    15083, 15091, 15101, 15107, 15121, 15131, 15137, 15139, 15149, 15161, 15173,
    15187, 15193, 15199, 15217, 15227, 15233, 15241, 15259, 15263, 15269, 15271,
    15277, 15287, 15289, 15299, 15307, 15313, 15319, 15329, 15331, 15349, 15359,
    15361, 15373, 15377, 15383, 15391, 15401, 15413, 15427, 15439, 15443, 15451,
    15461, 15467, 15473, 15493, 15497, 15511, 15527, 15541, 15551, 15559, 15569,
    15581, 15583, 15601, 15607, 15619, 15629, 15641, 15643, 15647, 15649, 15661,
    15667, 15671, 15679, 15683, 15727, 15731, 15733, 15737, 15739, 15749, 15761,
    15767, 15773, 15787, 15791, 15797, 15803, 15809, 15817, 15823, 15859, 15877,
    15881, 15887, 15889, 15901, 15907, 15913, 15919, 15923, 15937, 15959, 15971,
    15973, 15991, 16001, 16007, 16033, 16057, 16061, 16063, 16067, 16069, 16073,
    16087, 16091, 16097, 16103, 16111, 16127, 16139, 16141, 16183, 16187, 16189,
    16193, 16217, 16223, 16229, 16231, 16249, 16253, 16267, 16273, 16301, 16319,
    16333, 16339, 16349, 16361, 16363, 16369, 16381, 16411, 16417, 16421, 16427,
    16433, 16447, 16451, 16453, 16477, 16481, 16487, 16493, 16519, 16529, 16547,
    16553, 16561, 16567, 16573, 16603, 16607, 16619, 16631, 16633, 16649, 16651,
    16657, 16661, 16673, 16691, 16693, 16699, 16703, 16729, 16741, 16747, 16759,
    16763, 16787, 16811, 16823, 16829, 16831, 16843, 16871, 16879, 16883, 16889,
    16901, 16903, 16921, 16927, 16931, 16937, 16943, 16963, 16979, 16981, 16987,
    16993, 17011, 17021, 17027, 17029, 17033, 17041, 17047, 17053, 17077, 17093,
    17099, 17107, 17117, 17123, 17137, 17159, 17167, 17183, 17189, 17191, 17203,
    17207, 17209, 17231, 17239, 17257, 17291, 17293, 17299, 17317, 17321, 17327,
    17333, 17341, 17351, 17359, 17377, 17383, 17387, 17389 # first 2,000
  ]
  
  @doc """
  Encodes an integer codepoint 0 <= `n` <= 63 to its MIME Base64 character.
  
  ## Examples
    
      iex> Caustic.Utils.base64_encode_char(0)
      "A"
      iex> Caustic.Utils.base64_encode_char(5)
      "F"
      iex> Caustic.Utils.base64_encode_char(26)
      "a"
      iex> Caustic.Utils.base64_encode_char(31)
      "f"
      iex> Caustic.Utils.base64_encode_char(52)
      "0"
      iex> Caustic.Utils.base64_encode_char(57)
      "5"
      iex> Caustic.Utils.base64_encode_char(62)
      "+"
      iex> Caustic.Utils.base64_encode_char(63)
      "/"
  """
  def base64_encode_char(n) when is_integer(n) and 0 <= n and n <= 25 do
    ascii = ?A + n
    << ascii >>
  end

  def base64_encode_char(n) when is_integer(n) and 26 <= n and n <= 51 do
    ascii = ?a + n - 26
    << ascii >>
  end

  def base64_encode_char(n) when is_integer(n) and 52 <= n and n <= 61 do
    ascii = ?0 + n - 52
    << ascii >>
  end

  def base64_encode_char(n) when n === 62, do: "+"
  def base64_encode_char(n) when n === 63, do: "/"

  @doc """
  Gets the character code of a MIME base64 digit.
  
  ## Examples
    
      iex> Caustic.Utils.base64_decode_char("A")
      0
      iex> Caustic.Utils.base64_decode_char("F")
      5
      iex> Caustic.Utils.base64_decode_char("a")
      26
      iex> Caustic.Utils.base64_decode_char("f")
      31
      iex> Caustic.Utils.base64_decode_char("0")
      52
      iex> Caustic.Utils.base64_decode_char("5")
      57
      iex> Caustic.Utils.base64_decode_char("+")
      62
      iex> Caustic.Utils.base64_decode_char("/")
      63
  """
  def base64_decode_char(<<char_code>>), do: _base64_decode_char(char_code)
  
  def _base64_decode_char(char_code) when is_integer(char_code) and ?A <= char_code and char_code <= ?Z do
    char_code - ?A
  end

  def _base64_decode_char(char_code) when is_integer(char_code) and ?a <= char_code and char_code <= ?z do
    26 + char_code - ?a
  end

  def _base64_decode_char(char_code) when is_integer(char_code) and ?0 <= char_code and char_code <= ?9 do
    52 + char_code - ?0
  end

  def _base64_decode_char(char_code) when char_code === ?+, do: 62
  def _base64_decode_char(char_code) when char_code === ?/, do: 63

  @doc """
  Encodes a string into its MIME Base64 representation.
  
  https://en.wikipedia.org/wiki/Base64 (see Variants summary table)
  
  ## Examples
  
      iex> Caustic.Utils.base64_encode("Man")
      "TWFu"
      iex> Caustic.Utils.base64_encode("Ma")
      "TWE="
      iex> Caustic.Utils.base64_encode("M")
      "TQ=="
      iex> Caustic.Utils.base64_encode("Man is distinguished, not only by his reason, but by this singular passion from other animals...")
      "TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBieSB0aGlz\\r\\nIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLi4u"
      iex> Caustic.Utils.base64_encode("Man is distinguished, not only by his reason, but by this singular passion from other animals...", new_line: false)
      "TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBieSB0aGlzIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLi4u"
  """
  def base64_encode(data, opts \\ []) when is_binary(data), do: _base64_encode(data, [], 0, Keyword.get(opts, :new_line, true))

  defp _base64_encode(<<>>, acc, _len, _new_line?), do: Enum.reverse(acc) |> Enum.join()

  # Got 3 bytes
  defp _base64_encode(<<c1 :: size(6), c2 :: size(6), c3 :: size(6), c4 :: size(6), rest :: binary>>, acc, len, new_line?) do
    {acc, len} = _base64_append_newline(acc, len, new_line?)
    acc = [base64_encode_char(c4), base64_encode_char(c3), base64_encode_char(c2), base64_encode_char(c1) | acc]
    _base64_encode(rest, acc, len + 4, new_line?)
  end

  # The last block is 2 bytes
  defp _base64_encode(<<c1 :: size(6), c2 :: size(6), c3 :: size(4)>>, acc, len, new_line?) do
    {acc, len} = _base64_append_newline(acc, len, new_line?)
    c3 = c3 <<< 2
    acc = ["=", base64_encode_char(c3), base64_encode_char(c2), base64_encode_char(c1) | acc]
    _base64_encode(<<>>, acc, len + 4, new_line?)
  end

  # The last block is 1 byte
  defp _base64_encode(<<c1 :: size(6), c2 :: size(2)>>, acc, len, new_line?) do
    {acc, len} = _base64_append_newline(acc, len, new_line?)
    c2 = c2 <<< 4
    acc = ["=", "=", base64_encode_char(c2), base64_encode_char(c1) | acc]
    _base64_encode(<<>>, acc, len + 4, new_line?)
  end

  defp _base64_append_newline(acc, 76, true), do: {["\n", "\r" | acc], 0}
  defp _base64_append_newline(acc, 76, false), do: {acc, 0}
  defp _base64_append_newline(acc, len, _new_line), do: {acc, len}

  @doc """
  Decodes a MIME Base64 encoded string.
  
  https://en.wikipedia.org/wiki/Base64 (see Variants summary table)
  
  ## Examples
  
      iex> Caustic.Utils.base64_decode("TWFu")
      "Man"
      iex> Caustic.Utils.base64_decode("TWE=")
      "Ma"
      iex> Caustic.Utils.base64_decode("TQ==")
      "M"
      iex> Caustic.Utils.base64_decode("TWFuIGlzIGRpc3Rpbmd1aXNoZWQsIG5vdCBvbmx5IGJ5IGhpcyByZWFzb24sIGJ1dCBieSB0aGlz\\r\\nIHNpbmd1bGFyIHBhc3Npb24gZnJvbSBvdGhlciBhbmltYWxzLi4u")
      "Man is distinguished, not only by his reason, but by this singular passion from other animals..."
  """
  def base64_decode(str) do
    str_clean = _base64_decode_ignore_invalid_chars(str, [])
    _base64_decode(str_clean, [])
  end
  
  defp _base64_decode(<<>>, acc), do: Enum.reverse(acc) |> :binary.list_to_bin()

  defp _base64_decode(<<a, b, ?=, ?=, rest :: binary>>, acc) do
    a = _base64_decode_char(a)
    b = _base64_decode_char(b)
    <<x, _y, _z>> = <<a :: size(6), b :: size(6), 0 :: size(6), 0 :: size(6)>>
    _base64_decode(rest, [x | acc])
  end

  defp _base64_decode(<<a, b, c, ?=, rest :: binary>>, acc) do
    a = _base64_decode_char(a)
    b = _base64_decode_char(b)
    c = _base64_decode_char(c)
    <<x, y, _z>> = <<a :: size(6), b :: size(6), c :: size(6), 0 :: size(6)>>
    _base64_decode(rest, [y, x| acc])
  end
  
  defp _base64_decode(<<a, b, c, d, rest :: binary>>, acc) do
    a = _base64_decode_char(a)
    b = _base64_decode_char(b)
    c = _base64_decode_char(c)
    d = _base64_decode_char(d)
    <<x, y, z>> = <<a :: size(6), b :: size(6), c :: size(6), d :: size(6)>>
    _base64_decode(rest, [z, y, x | acc])
  end
  
  defp _base64_decode_ignore_invalid_chars(<<>>, acc), do: Enum.reverse(acc) |> Enum.join()
  defp _base64_decode_ignore_invalid_chars(<<c, rest :: binary>>, acc) 
    when (?A <= c
      and c <= ?Z)
    or (?a <= c
      and c <= ?z)
    or (?0 <= c
      and c <= ?9)
    or c == ?+
    or c == ?/
    or c == ?=,
  do: _base64_decode_ignore_invalid_chars(rest, [<<c>> | acc])
  defp _base64_decode_ignore_invalid_chars(<<_c, rest :: binary>>, acc), do: _base64_decode_ignore_invalid_chars(rest, acc)
  
  @doc """
  Converts a bitstring (including binary) into array of 0s and 1s.
  For simple binary you can also use :binary.decode_unsigned
  
  ## Examples
  
      iex> Caustic.Utils.bitstring_to_array "Hey"
      [0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1]
      iex> Caustic.Utils.bitstring_to_array << 1 :: size(1), 0 :: size(1), 1 :: size(1) >>
      [1, 0, 1]
  """
  def bitstring_to_array(data) when is_bitstring(data), do: _bitstring_to_array(data, [])
  
  defp _bitstring_to_array(<<>>, acc), do: Enum.reverse(acc)
  
  defp _bitstring_to_array(<< n :: size(1), rest :: bitstring >>, acc) do
    _bitstring_to_array(rest, [n | acc])
  end
  
  @doc """
  Calculates integer exponentiation. Exponent can be negative.
  
  ## Examples
  
      iex> Caustic.Utils.pow(3, 9)
      19683
      iex> Caustic.Utils.pow(2, 8)
      256
      iex> Caustic.Utils.pow(2, 256)
      115792089237316195423570985008687907853269984665640564039457584007913129639936
      iex> Caustic.Utils.pow(2, -2)
      0.25
  """
  def pow(n, p) when is_integer(p) and p > 0, do: _pow(n, p, 1)
  def pow(0, 0), do: raise(ArithmeticError, "Division by zero")
  def pow(_, 0), do: 1
  def pow(n, p), do: 1.0 / pow(n, -p)
  
  defp _pow(_n, 0, acc), do: acc
  defp _pow(n, p, acc) when rem(p, 2) == 0, do: _pow(n * n, div(p, 2), acc)
  defp _pow(n, p, acc), do: _pow(n, p - 1, n * acc)
  
  @doc """
  Lists the exponents of `n` when `n` is represented as binary.
  For example, `34` in binary is `100010` or `2^5 + 2^1`, so
  the function will return `[1, 5]`.
  
  ## Examples
  
      iex> Caustic.Utils.binary_exponents(0)
      []
    
      iex> Caustic.Utils.binary_exponents(2)
      [1]
    
      iex> Caustic.Utils.binary_exponents(32)
      [5]
    
      iex> Caustic.Utils.binary_exponents(33)
      [0, 5]
  """
  def binary_exponents(n) when is_integer(n) and n >= 0 do
    _binary_exponents n, []
  end
  
  defp _binary_exponents(0, acc), do: acc
  defp _binary_exponents(rem, acc) do
    {next, rem} = log2i(rem)
    _binary_exponents rem, [next | acc]
  end
  
  @doc """
  Interprets a bitstring (including binary) as an unsigned integer. You can use :binary.decode_unsigned/1
  if it's a normal binary.
  
  ## Examples
  
      iex> Caustic.Utils.bitstring_to_integer(<<255, 255>>)
      65535
  """
  def bitstring_to_integer(data) when is_bitstring(data) and data != "" do
    len = bit_size(data)
    <<n :: size(len)>> = data
    n
  end

  @doc """
  Encodes an integer into its base58 representation. If given a string, by default it will
  interpret the string as a hex.
  
  If given hex and it has leading zeros, then each byte of zeros will be encoded as 1.
  
  ## Examples
  
      iex> Caustic.Utils.base58_encode("801e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aeddc47e83ff")
      "5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn"
      iex> Caustic.Utils.base58_encode(<<57>>, convert_from_hex: false)
      "z"
      iex> Caustic.Utils.base58_encode(63716817338599314535577169638518475271320430400871647684951348108655027767484127754748927)
      "5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn"
      iex> Caustic.Utils.base58_encode("0x000001")
      "112"
  """
  def base58_encode(str, opts \\ [])
  def base58_encode(str, opts) when is_binary(str) do
    opts = opts ++ [convert_from_hex: true]
    {n, padding} = if opts[:convert_from_hex] do
      n = str |> to_integer(16)
      padding = str |> hex_remove_prefix() |> _hex_get_zero_padding()
      {n, padding}
    else
      n = str |> :binary.decode_unsigned()
      padding = _binary_get_zero_padding(str)
      {n, padding}
    end
    
    _base58_encode_with_padding(n, padding)
  end
  
  def base58_encode(n, _opts) when is_integer(n) and 0 <= n and n <= 57 do
    String.slice(@base58_table, n, 1)
  end
  
  def base58_encode(n, _opts) when is_integer(n) and n >= 0 do
    to_digits(n, 58) |> Enum.map_join(&base58_encode/1)
  end
  
  def _base58_encode_with_padding(n, padding) do
    prefix = String.duplicate("1", padding)
    prefix <> base58_encode(n)
  end

  def _hex_get_zero_padding(str, acc \\ 0)
  def _hex_get_zero_padding(<<?0, ?0, rest::binary>>, acc), do: _hex_get_zero_padding(rest, acc + 1)
  def _hex_get_zero_padding(str, acc) do
    if rem(String.length(str), 2) == 0, do: acc, else: 0
  end

  def _binary_get_zero_padding(data, acc \\ 0)
  def _binary_get_zero_padding(<<0x00, rest::binary>>, acc), do: _binary_get_zero_padding(rest, acc + 1)
  def _binary_get_zero_padding(_, acc), do: acc
  
  #def _hex_remove_prefix
  
  @doc """
  Same as base58_decode but outputs an integer instead of hex string.
  """
  def base58_to_integer(str) when is_binary(str), do: _base58_to_integer(str, 0)
  
  defp _base58_to_integer(<<>>, acc), do: acc
  defp _base58_to_integer(<<c, rest :: binary>>, acc) do
    c = << c >>
    value = string_index_of @base58_table, c
    _base58_to_integer(rest, acc * 58 + value)
  end
  
  @doc """
  Decode a base58-encoded string into its hexadecimal string representation.
  
  ## Examples
  
      iex> Caustic.Utils.base58_decode("5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn")
      "0x801e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aeddc47e83ff"
      iex> Caustic.Utils.base58_decode("5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn", prefix: false)
      "801e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aeddc47e83ff"
  """
  def base58_decode(str, opts \\ []), do: base58_to_integer(str) |> to_string(16, opts)
  
  @doc """
  Encodes a binary to its base58check representation.
  
  Possible values for version: `:address`, `:address_p2sh`, `:address_testnet`,
  `private_key_wif`, `private_key_bip38_encrypted`, `public_key_bit32_extended`
  
  Can also use custom binary version.
  
  ## Examples
  
      iex> Caustic.Utils.base58check_encode("0x1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd", :private_key_wif)
      "5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn"
      iex> Caustic.Utils.base58check_encode(<<Caustic.Utils.to_integer("0x1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd")::size(256)>>, :private_key_wif, convert_from_hex: false)
      "5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn"
      iex> Caustic.Utils.base58check_encode(<<Caustic.Utils.to_integer("0x1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd")::size(256), 0x01>>, :private_key_wif, convert_from_hex: false)
      "KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ"
      iex> Caustic.Utils.base58check_encode(<<Caustic.Utils.to_integer("1E99423A4ED27608A15A2616A2B0E9E52CED330AC530EDCC32C8FFC6A526AEDD", 16)::size(256), 0x01>>, :private_key_wif, convert_from_hex: false)
      "KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ"
      iex> Caustic.Utils.base58check_encode("f5f2d624cfb5c3f66d06123d0829d1c9cebf770e", :address)
      "1PRTTaJesdNovgne6Ehcdu1fpEdX7913CK"
      iex> Caustic.Utils.base58check_encode("000000cb23faea20aa20f02a02955ffd1d785518", :address)
      "1111DVWAb9XQh88gakJRcK14e1i1onvAL" # private key is 5KjhZsxt61XSPunjrPm8XUEAH1YN6zXm6pqT5D1hZ9mLoEAqKTp
  """
  def base58check_encode(payload, version, opts \\ []) do
    opts = opts ++ [convert_from_hex: true]
    
    if opts[:convert_from_hex] do
      payload_i = to_integer(payload, 16)
      size = 4 * String.length(hex_remove_prefix(payload))
      payload_raw = <<payload_i::size(size)>>
      _base58check_encode(payload_raw, version)
    else
      _base58check_encode(payload, version)
    end
  end
  
  def _base58check_encode(payload, version) when is_atom(version), do: _base58check_encode(payload, Map.fetch!(@base58_version, version))
  
  def _base58check_encode(payload, version) when is_binary(payload) and is_binary(version) do
    payload_with_version = version <> payload
    checksum = base58_checksum(payload_with_version)
    final_payload = payload_with_version <> checksum
    final_payload |> base58_encode(convert_from_hex: false)
  end
  
  def base58_checksum(data) do
    <<checksum::size(32), _rest::binary>> = :crypto.hash(:sha256, :crypto.hash(:sha256, data))
    <<checksum::size(32)>>
  end
  
  def base58_version(data) do
    _base58_version(data, Map.keys(@base58_version))
  end
  
  defp _base58_version(data, []), do: {nil, data}
  defp _base58_version(data, [key | rest]) do
    prefix = @base58_version[key]
    prefix_length = byte_size(prefix)
    case data do
      <<^prefix::binary-size(prefix_length), payload::binary>>
        -> {key, payload}
      _
        -> _base58_version(data, rest)
    end
  end
  
  @doc """
  Returns checksum, payload, and version
  
  ## Examples
  
      iex> Caustic.Utils.base58check_decode "5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn"
      {:ok, <<196, 126, 131, 255>>, "1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd", :private_key_wif}
      iex> Caustic.Utils.base58check_decode "1J7mdg5rbQyUHENYdx39WVWK7fsLpEoXZy"
      {:ok, <<55, 254, 252, 208>>, "bbc1e42a39d05a4cc61752d6963b7f69d09bb27b", :address}
  """
  def base58check_decode(str) do
    str_i = base58_to_integer(str)
    {exp, remainder} = log2i(str_i)
    bin_digit = exp + (if remainder == 0, do: 0, else: 1)
    bin_digit = bin_digit + rem(bin_digit, 8) # multiple of 1 byte
    data_bin_size = div(bin_digit - 32, 8)
    <<data_bin::binary-size(data_bin_size), checksum::binary>> = <<str_i::size(bin_digit)>>
    data_normalized = _base58check_data_normalize(data_bin)

    #<<data_int::size(data_bin_size), checksum::binary>> = <<str_i::size(bin_digit)>>
    #data_bin = <<data_int::size(data_bin_size)>>
    checksum_computed = base58_checksum(data_normalized)

    #IO.puts("Data is #{inspect(data_bin)}")
    #IO.puts("Checksum is #{inspect(checksum)}")
    
    if checksum_computed != checksum do
      {:error, "Checksum doesn't match. Computed #{inspect(checksum_computed)} vs actual #{inspect(checksum)}"}
    else
      {version, payload_bin} = base58_version(data_normalized)
      payload_hex = Base.encode16(payload_bin, case: :lower)
      #IO.puts("Version is #{inspect @base58_version[version]}")
      #IO.puts("Payload id #{inspect payload_bin}")
      
      # bx uses :binary.decode_unsigned(checksum, :little) to print checksum
      {:ok, checksum, payload_hex, version}
    end
  end
  
  # data of type :bitcoin_address has prefix 0x00 which is lost on encoding,
  # so we need to restore it.
  defp _base58check_data_normalize(data) do
    _base58check_data_normalize(data, Map.values(@base58_version))
  end

  defp _base58check_data_normalize(data, []) do
    # address size must be 20 bytes, so with version it is 21 bytes
    target_size = 21
    current_size = byte_size(data)
    diff = (target_size - current_size) * 8
    <<0x00::size(diff), data::binary>>
  end
                                            
  defp _base58check_data_normalize(data, [prefix | rest]) do
    len = byte_size(prefix)
    case data do
       <<^prefix::binary-size(len), _rest::binary>> -> data
       _ -> _base58check_data_normalize(data, rest)
    end
  end
  
  def log2i(n) when is_integer(n) and n >=1 do
    res = _log2i(n, 0)
    {res, rem(n, pow(2, res))}
  end
  defp _log2i(1, acc), do: acc
  defp _log2i(n, acc), do: _log2i(div(n, 2), acc + 1)
  
  @doc """
  Converts a Bitcoin 256-bit private key to the Wallet Import Format. Defaults to outputting compressed format.
  
  ## Examples
  
      iex> Caustic.Utils.bitcoin_private_key_to_wif("1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd")
      "KxFC1jmwwCoACiCAWZ3eXa96mBM6tb3TYzGmf6YwgdGWZgawvrtJ"
      iex> Caustic.Utils.bitcoin_private_key_to_wif("1e99423a4ed27608a15a2616a2b0e9e52ced330ac530edcc32c8ffc6a526aedd", compressed: false)
      "5J3mBbAH58CpQ3Y5RNJpUKPE62SQ5tfcvU2JpbnkeyhfsYB1Jcn"
  """
  def bitcoin_private_key_to_wif(hex_str, opts \\ []) do
    opts = opts ++ [compressed: true]
    hex_str = if opts[:compressed], do: hex_str <> "01", else: hex_str
    base58check_encode(hex_str, :private_key_wif)
  end
  
  @doc """
  Finds the index of an ASCII character inside a string. Not unicode friendly!
  
  ## Examples
  
      iex> Caustic.Utils.string_index_of("Hello", "H")
      0
      iex> Caustic.Utils.string_index_of("Hello", "h")
      nil
      iex> Caustic.Utils.string_index_of("Hello", "l")
      2
  """
  def string_index_of(str, c), do: _string_index_of(str, c, 0)
  defp _string_index_of(<<>>, _c, _), do: nil
  defp _string_index_of(<<next, _rest :: binary>>, c, i) when << next >> == c, do: i
  defp _string_index_of(<<_next, rest :: binary>>, c, i), do: _string_index_of(rest, c, i + 1)

  @doc """
  Find the digits of a nonnegative integer `n` in a particular `base`.
  
  ## Examples
      iex> Caustic.Utils.to_digits(321, 10)
      [3, 2, 1]
      iex> Caustic.Utils.to_digits(5, 2)
      [1, 0, 1]
      iex> Caustic.Utils.to_digits(255, 16)
      [15, 15]
      iex> Caustic.Utils.to_digits(0, 8)
      [0]
  """
  def to_digits(n, base)
    when is_integer(n)
    and is_integer(base)
    and n >= 0
    and base >= 2 do
    _to_digits(n, base, [])
  end

  defp _to_digits(0, _base, []), do: [0]
  defp _to_digits(0, _base, acc), do: acc
  defp _to_digits(n, base, acc) do
    d = div(n, base)
    r = rem(n, base)
    _to_digits(d, base, [r | acc])
  end
  
#  @doc """
#  Convert a digit's integer representation to its string representation.
#  
#  ## Examples
#  
#    iex> Caustic.Utils.to_string(8, 10)
#    "8"
#    iex> Caustic.Utils.to_string(15, 16)
#    "f"
#  """
#  def to_string(n, base)
#    when is_integer(n)
#    and is_integer(base)
#    and n >= 0
#    and base >= 2
#    and n < base
#    and base <= 36
#    do
#    _to_string(n, base)
#  end
  
  @doc """
  Convert an integer into its string representation in any `base`.
  
  ## Examples
  
      iex> Caustic.Utils.to_string(255, 16)
      "0xff"
      iex> Caustic.Utils.to_string(255, 16, prefix: false)
      "ff"
      iex> Caustic.Utils.to_string(5, 2)
      "0b101"
  """
  def to_string(n, base, opts \\ []) do
    opts = opts ++ [prefix: true, padding: 0]
    str = to_digits(n, base) |> Enum.map_join(&_to_string(&1, base))

    str = String.pad_leading(str, opts[:padding], "0")
    
    prefix = if opts[:prefix], do: Map.get(@base_prefixes, base, ""), else: "" 
    prefix <> str
  end

  defp _to_string(n, _base) when n <= 9, do: to_string(n)
  defp _to_string(n, _base), do: <<?a + n - 10>>
  
  @doc """
  Parse a string which can be in any base to integer, autodetecting the base using the prefix.
  
  ## Examples
  
      iex> Caustic.Utils.to_integer("0xff")
      255
      iex> Caustic.Utils.to_integer("0b101")
      5
      iex> Caustic.Utils.to_integer("321")
      321
  """
  def to_integer(str) do
    base = get_base(String.downcase(str))
    to_integer(str, base)
  end

  @doc """
  Parse a string which can be in any base to integer, specifying the base.
  
  ## Examples
  
      iex> Caustic.Utils.to_integer("ff", 16)
      255
      iex> Caustic.Utils.to_integer("101", 2)
      5
      iex> Caustic.Utils.to_integer("755", 8)
      493
      iex> Caustic.Utils.to_integer("321", 10)
      321
  """
  def to_integer(str, base) do
    str = String.downcase(str)
    prefix = Map.get(@base_prefixes, base)
    if prefix == nil do
      _to_integer(str, base)
    else
      if String.starts_with?(str, prefix) do
        prefix_len = String.length(prefix)
        rest = String.slice(str, prefix_len..-1)
        _to_integer(rest, base)
      else
        _to_integer(str, base)
      end
    end
  end
  
  defp _to_integer(str, base) do
    _to_integer(str, base, 0)
  end
  
  defp _to_integer(<<>>, _base, acc), do: acc
  
  defp _to_integer(<<digit, rest :: binary>>, base, acc) do
    acc = acc * base + _digit_to_integer(digit, base)
    _to_integer(rest, base, acc)
  end
  
  defp _digit_to_integer(char_code, base) when ?0 <= char_code and char_code <= ?9 and char_code - ?0 < base, do: char_code - ?0
  defp _digit_to_integer(char_code, base) when ?a <= char_code and char_code <= ?z and 10 + char_code - ?a < base, do: 10 + char_code - ?a
  
  @doc """
  Guess the base of an integer string using its prefix. Defaults to 10, and doesn't check for validity of the digits.
  
  ## Examples
  
      iex> Caustic.Utils.get_base("0xabf")
      16
      iex> Caustic.Utils.get_base("0b101")
      2
      iex> Caustic.Utils.get_base("321")
      10
  """
  def get_base(str) do
    keys = Map.keys @base_prefixes
    _get_base(str, keys)
  end
  
  defp _get_base(str, [base | rest]) do
    prefix = @base_prefixes[base]
    if String.starts_with?(str, prefix),
      do: base,
      else: _get_base(str, rest)
  end
  
  defp _get_base(<<c, rest :: binary>>, []) when ?0 <= c and c <= ?9, do: _get_base(rest, [])
  defp _get_base("", []), do: 10
  
  @doc """
  Removes hexadecimal prefix from a string.
  
  ## Examples
  
      iex> Caustic.Utils.hex_remove_prefix("0xff")
      "ff"
      iex> Caustic.Utils.hex_remove_prefix("0XFF")
      "FF"
      iex> Caustic.Utils.hex_remove_prefix("ff")
      "ff"
  """
  def hex_remove_prefix(str) do
    if String.starts_with?(str, ["0x", "0X"]) do
      String.slice(str, 2..-1)
    else
      str
    end
  end

  @doc """
  Finds the least residue of a number modulo `m`.
  
  ## Examples
  
      iex> Caustic.Utils.mod(0, 3)
      0
      iex> Caustic.Utils.mod(-27, 13)
      12
      iex> Caustic.Utils.mod(-3, 3)
      0
  """
  def mod(x, m) when x >= 0, do: rem(x, m)
  def mod(x, m) when x < 0, do: rem(rem(x, m) + m, m)

  @doc """
  Fast exponentiation modulo m. Calculates x^y mod m.
  
  With x = 5, y = 12345, m = 17, and repeated 1000 times,
  it is faster by naive method by a factor of 150 on
  a particular benchmark machine.

  https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/modular-exponentiation
  https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/fast-modular-exponentiation
  
  ## Examples
  
      iex> Caustic.Utils.pow_mod(5, 0, 19)
      1
      iex> Caustic.Utils.pow_mod(5, 1, 19)
      5
      iex> Caustic.Utils.pow_mod(5, 117, 19)
      1
      iex> Caustic.Utils.pow_mod(7, 256, 13)
      9
      iex> Caustic.Utils.pow_mod(2, 90, 13)
      12
      iex> Caustic.Utils.pow_mod(50, -1, 71)
      27
      iex> Caustic.Utils.pow_mod(7, -3, 13)
      8
  """
  def pow_mod(x, -1, m), do: mod_inverse(x, m)
  def pow_mod(x, y, m) when y < -1 do
    inverse = pow_mod(x, -1, m)
    pow_mod(inverse, -y, m)
  end
  def pow_mod(x, y, m) do
    digits = to_digits(y, 2)
    
    digits
    |> Enum.reverse()
    |> Enum.reduce({1, mod(x, m)}, fn n, {acc, factor} ->
      acc = if n == 0, do: acc, else: acc * factor
      factor = factor * factor |> mod(m)
      {acc, factor}
    end)
    |> elem(0)
    |> mod(m)
  end
  
  @doc """
  Find the greatest common divisor of two integers.
  
  Proof: https://www.khanacademy.org/computing/computer-science/cryptography/modarithmetic/a/the-euclidean-algorithm
  
  ## Examples

      iex> Caustic.Utils.gcd(1, 0)
      1

      iex> Caustic.Utils.gcd(-1, 0)
      1
  
      iex> Caustic.Utils.gcd(270, 192)
      6

      iex> Caustic.Utils.gcd(-270, 192)
      6

      iex> Caustic.Utils.gcd(270, -192)
      6

      iex> Caustic.Utils.gcd(-270, -192)
      6
  """
  def gcd(a, b) when a < 0, do: gcd(-a, b)
  def gcd(a, b) when b < 0, do: gcd(a, -b)
  def gcd(a, b) when a != 0 or b != 0, do: _gcd(a, b)
  def _gcd(0, b), do: b
  def _gcd(a, 0), do: a
  def _gcd(a, b) do
    #q = div(a, b)
    r = mod(a, b)
    _gcd(b, r)
  end

  @doc """
  Find the greatest common divisor `d` of two integers `a` and `b`, while also finding
  the coefficients `x` and `y` such that `ax + by = d`.

  ## Examples
      iex> Caustic.Utils.gcd_with_coefficients(3, 0)
      {3, 1, 0}

      iex> Caustic.Utils.gcd_with_coefficients(6, 3)
      {3, 0, 1}

      iex> Caustic.Utils.gcd_with_coefficients(270, 192)
      {6, 5, -7}

      iex> Caustic.Utils.gcd_with_coefficients(-270, 192)
      {6, -5, -7}

      iex> Caustic.Utils.gcd_with_coefficients(270, -192)
      {6, 5, 7}

      iex> Caustic.Utils.gcd_with_coefficients(-270, -192)
      {6, -5, 7}

      iex> Caustic.Utils.gcd_with_coefficients(314, 159)
      {1, -40, 79}
  """
  def gcd_with_coefficients(a, b) when a < 0 do
    {d, x, y} = gcd_with_coefficients(-a, b)
    {d, -x, y}
  end

  def gcd_with_coefficients(a, b) when b < 0 do
    {d, x, y} = gcd_with_coefficients(a, -b)
    {d, x, -y}
  end

  def gcd_with_coefficients(a, b) when a < b do
    {d, x, y} = gcd_with_coefficients(b, a)
    {d, y, x}
  end

  def gcd_with_coefficients(a, b) when a != 0, do: _gcd_with_coefficients(a, b, 1, 0, 0, 1)

  def _gcd_with_coefficients(a, 0, x, y, _, _), do: {a, x, y}

  def _gcd_with_coefficients(a, b, x_prev_prev, y_prev_prev, x_prev, y_prev) do
    q = div(a, b)
    r = mod(a, b)
    x = x_prev_prev - q * x_prev
    y = y_prev_prev - q * y_prev
    _gcd_with_coefficients(b, r, x_prev, y_prev, x, y)
  end

  @doc """
  Find the modular inverse (modular multiplicative inverse).
  
  Using Euclidean Algorithm: https://www.math.utah.edu/~fguevara/ACCESS2013/Euclid.pdf
  
  ## Examples
  
      iex> Caustic.Utils.mod_inverse(1, 101)
      1
      iex> Caustic.Utils.mod_inverse(2, 3)
      2
      iex> Caustic.Utils.mod_inverse(50, 71)
      27
      iex> Caustic.Utils.mod_inverse(25, 50)
      nil
      iex> Caustic.Utils.mod_inverse(8, 11)
      7
      iex> Caustic.Utils.mod_inverse(345, 76408)
      48281
      iex> Caustic.Utils.mod_inverse(71, 50)
      31
    
      # Bitcoin elliptic curve
      iex> Caustic.Utils.mod_inverse(345, 115792089237316195423570985008687907853269984665640564039457584007908834671663)
      53029420578249156164997726467746925915410601672960026429664632676085785153979
  """
  def mod_inverse(a, m) when a >= m or a < 0, do: mod_inverse(mod(a, m), m)
  def mod_inverse(a, m) do
    result = _mod_inverse(m, a)
    if result == nil, do: nil, else: mod(result, m) # normalize to 0 < inverse < m
  end

  # instead of using sentinel values q_prev = nil and q_prev_prev = nil
  # the equation works perfectly if we use initial values of q_prev = 1 and q_prev_prev = 0
  defp _mod_inverse(m, a, q_prev \\ 1, q_prev_prev \\ 0)
  
  # not coprimes, doesn't have inverse mod m
  defp _mod_inverse(_m, 0, _, _), do: nil
  
  defp _mod_inverse(_m, 1, q_prev, _), do: q_prev
  
  defp _mod_inverse(m, a, q_prev, q_prev_prev) do
    q = div(m, a)
    r = mod(m, a)

    #IO.puts("[#{m}] = [#{a}] . #{q} + #{r}")
    
    _mod_inverse(a, r, q_prev_prev - q * q_prev, q_prev)
  end

  # 1 is a unit
  def prime?(n) when n <= 1, do: false
  def prime?(n), do: _prime?(n, 2)

  # if a number n is composite, then it is divisible by a prime
  # less than or equal to sqrt(n)
  # TODO: Optimize using the first n primes
  defp _prime?(n, factor) when factor * factor > n, do: true
  defp _prime?(n, factor) when rem(n, factor) == 0, do: false
  defp _prime?(n, factor), do: _prime?(n, factor + 1)

  # 1 is a unit
  @doc """
  Checks whether an integer `n > 1` is a composite number. 1 is a unit,
  neither a prime nor composite. Will return false on `n <= 1`.

  ## Examples

      iex> Caustic.Utils.composite?(4)
      true
      iex> Caustic.Utils.composite?(2)
      false
      iex> Caustic.Utils.composite?(3)
      false
      iex> Caustic.Utils.composite?(1)
      false
  """
  def composite?(n) when n <= 1, do: false
  def composite?(n), do: not prime?(n)

  @doc """
  Find the prime factors of an integer.
  
  ## Examples

      iex> Caustic.Utils.factorize(72)
      [2, 2, 2, 3, 3]
      iex> Caustic.Utils.factorize(480)
      [2, 2, 2, 2, 2, 3, 5]
      iex> Caustic.Utils.factorize(357171293798123)
      [7, 181, 1459, 193216691]
      iex> Caustic.Utils.factorize(100000001)
      [17, 5882353]
      iex> Caustic.Utils.factorize(9223372036854775807) # largest 64-bit integer
      [7, 7, 73, 127, 337, 92737, 649657]
      iex> Caustic.Utils.factorize(18446744073709551615) # largest 64-bit unsigned integer
      [3, 5, 17, 257, 641, 65537, 6700417]
      iex> Caustic.Utils.factorize(18446744073709551615 * 3571 * 5901331)
      [3, 5, 17, 257, 641, 3571, 65537, 5901331, 6700417]
      iex> Caustic.Utils.factorize(1)
      []
  """
  def factorize(n) when n <= 1, do: []
  def factorize(n), do: _factorize(n, [])

  defp _factorize(1, factors), do: factors |> Enum.reverse()
  defp _factorize(n, factors) do
    p = smallest_prime_divisor(n)
    _factorize(div(n, p), [p | factors])
  end
  
  def factorize_grouped(n) do
    factorize(n)
    |> Enum.reduce([], fn
      n, [{n, count} | rest] ->
        [{n, count + 1} | rest]
      n, acc ->
        [{n, 1} | acc]
    end)
    |> Enum.reverse()
  end

#  defp _factorize(n, factors) do
#    sqrt = floor(:math.sqrt(n))
#    divisors = 2..sqrt |> Enum.filter(& rem(n, &1) == 0)
#    smallest_prime_divisor = divisors |> Enum.filter(&prime?/1) |> List.first()
#    smallest_prime_divisor = if smallest_prime_divisor === nil, do: n, else: smallest_prime_divisor
#    factors = [smallest_prime_divisor | factors]
#    _factorize(div(n, smallest_prime_divisor), factors)
#  end

  @doc """
  ## Examples
  
      iex> Caustic.Utils.smallest_prime_divisor(2)
      2
      iex> Caustic.Utils.smallest_prime_divisor(4)
      2
      iex> Caustic.Utils.smallest_prime_divisor(144)
      2
      iex> Caustic.Utils.smallest_prime_divisor(5)
      5
      iex> Caustic.Utils.smallest_prime_divisor(35)
      5
  """
  def smallest_prime_divisor(n) when n <= 1, do: nil
  def smallest_prime_divisor(n) when rem(n, 2) == 0, do: 2
  def smallest_prime_divisor(n), do: _smallest_prime_divisor(n, 3)

  defp _smallest_prime_divisor(n, factor) when factor * factor > n, do: n
  defp _smallest_prime_divisor(n, factor) when rem(n, factor) == 0, do: factor
  defp _smallest_prime_divisor(n, factor), do: _smallest_prime_divisor(n, factor + 2)
#
#    if prime?(factor), do: factor, else: _smallest_prime_divisor(n, factor + 1)
#  end

  @doc """
  Checks whether an integer is a prime using Sieve of Eratosthenes algorithm.
  Don't use on very large numbers.
  """
  def prime_sieve?(n) when n <= 1, do: false
  def prime_sieve?(n) do
    sieve = List.duplicate(true, n + 1) |> List.to_tuple() # assume all are primes
    _prime_sieve?(n, 2, sieve)
  end

  defp _prime_sieve?(n, factor, _sieve) when factor * factor > n, do: true
  defp _prime_sieve?(n, factor, sieve) do
    is_prime = elem(sieve, factor)
    if is_prime do
      {sieve, n_is_composite} = _sieve_sweep(sieve, factor * 2, factor)
      if n_is_composite, do: false, else: _prime_sieve?(n, factor + 1, sieve)
    else
      _prime_sieve?(n, factor + 1, sieve)
    end
  end

  defp _sieve_sweep(sieve, next, _factor) when next == tuple_size(sieve) - 1, do: {sieve, true}
  defp _sieve_sweep(sieve, next, _factor) when next >= tuple_size(sieve), do: {sieve, false}
  defp _sieve_sweep(sieve, next, factor) do
    sieve = put_elem(sieve, next, false)
    _sieve_sweep(sieve, next + factor, factor)
  end

  # {time, res} = :timer.tc(Utils, :prime_sieve_up_to, [10_000_000])
  # {time, :ok} = :timer.tc Utils, :write_to_file, [Enum.to_list(1..10_000_000), "/tmp/elixir_test_out_2.txt", 10] # 2 minutes
  @doc """
  Find all primes `p  n` using Sieve of Eratosthenes method.
  
  ## Examples
      iex> Caustic.Utils.prime_sieve_up_to(10)
      [2, 3, 5, 7]

      iex> Caustic.Utils.prime_sieve_up_to(30)
      [2, 3, 5, 7, 11, 13, 17, 19, 23, 29]

      iex> Caustic.Utils.prime_sieve_up_to(100)
      [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97]
  """
  def prime_sieve_up_to(n) when n >= 2 do
#    easy_primes = [ 2,  3,  5,  7, 11,
#                   13, 17, 19, 23, 29]
    easy_primes = @primes
    first_sieves = 2..n |> Enum.filter(&_potentially_prime?(&1, easy_primes))
    check_limit = trunc(:math.sqrt(n))

    {left, right} = list_split first_sieves, Enum.count(easy_primes)
    left = left |> Enum.filter(& &1 <= n)
    if Enum.count(right) == 0 do
      left
    else
      _prime_sieve_up_to(check_limit, Enum.reverse(left), right)
    end
  end
  
  @doc """
  Determines whether an integer is a perfect number.
  A number n is perfect iff (n) - n = n
  
  ## Examples
  
      iex> Caustic.Utils.perfect?(6)
      true
      iex> Caustic.Utils.perfect?(5)
      false
  """
  def perfect?(n) when is_number(n) and n > 0 do
    proper_divisors_sum(n) == n
  end
  
  @doc """
  The other number of an amicable pair, if any.
  
  ## Examples
  
      iex> Caustic.Utils.amicable_pair(220)
      284
      iex> Caustic.Utils.amicable_pair(2)
      nil
  """
  def amicable_pair(n) do
    sum = proper_divisors_sum(n)
    if sum != n and proper_divisors_sum(sum) == n do
      sum
    else
      nil
    end
  end
  
  @doc """
  Euler's totient function `(n)`.
  The number of positive integers less than or equal to `m`
  and relatively prime to `m`.
  
  ## Examples
  
      iex> Caustic.Utils.totient(5)
      4
    
      iex> Caustic.Utils.totient(6)
      2
    
      iex> Caustic.Utils.totient(9)
      6
    
      iex> Caustic.Utils.totient(1)
      1
    
      iex> Caustic.Utils.totient(4200)
      960
  """
  def totient(m) do
    factorize_grouped(m)
    |> Enum.reduce(1, fn {p, e}, acc -> acc * _totient_prime(p, e) end)
  end
  
  def _totient_prime(p, e), do: pow(p, e - 1) * (p - 1)
  
  @doc """
  Positive integers less than or equal to `m` and relatively prime to `m`.
  
  ## Examples
  
      iex> Caustic.Utils.totient_members(1)
      [1]
    
      iex> Caustic.Utils.totient_members(6)
      [1, 5]
    
      iex> Caustic.Utils.totient_members(9)
      [1, 2, 4, 5, 7, 8]
    
      iex> Caustic.Utils.totient_members(10)
      [1, 3, 7, 9]
  """
  def totient_members(m) when is_integer(m) and m > 0 do
    1..m |> Enum.filter(&gcd(m, &1) === 1)
  end 

  @doc """
  Splits a list into its first `n` elements and the rest.

  ## Examples

      iex> Caustic.Utils.list_split([1, 2, 3, 4, 5], 2)
      {[1, 2], [3, 4, 5]}

      iex> Caustic.Utils.list_split([1, 2, 3], 5)
      {[1, 2, 3], []}
  """
  def list_split(objs, n) when n >= 0, do: _list_split([], objs, n)

  defp _list_split(left, right, 0), do: {Enum.reverse(left), right}
  defp _list_split(left, [], _), do: _list_split(left, [], 0)
  defp _list_split(left, [o | rest], n), do: _list_split([o | left], rest, n - 1)

  defp _prime_sieve_up_to(check_limit, left, right = [p | _]) when p > check_limit do
    Enum.reverse(left) ++ right
  end
  defp _prime_sieve_up_to(check_limit, left, [p | rest]) do
    rest = rest |> Enum.filter(& rem(&1, p) != 0)
    _prime_sieve_up_to(check_limit, [p | left], rest)
  end

  defp _potentially_prime?(_n, []), do: true
  defp _potentially_prime?(n, [d | rest]) do
    if d < n and rem(n, d) == 0 do
      false
    else
      _potentially_prime?(n, rest)
    end
  end

  def write_to_file(list, path, item_per_line) do
    {:ok, file} = File.open path, [:write] # or :append
    :ok = _write_to_file file, list, item_per_line, 0
    File.close file
  end

  defp _write_to_file(_file, [], _, _), do: :ok
  defp _write_to_file(file, [item | rest], item_per_line, i) do
    IO.binwrite file, "#{item}"

    if rem(i, item_per_line) === item_per_line - 1 do
      IO.binwrite file, "\n"
    else
      IO.binwrite file, " "
    end

    _write_to_file file, rest, item_per_line, i + 1
  end
  
  @doc """
  https://oeis.org/A000043
  https://en.wikipedia.org/wiki/Mersenne_prime
  The first `n` Mersenne exponents, primes `p` such that `2^p - 1` is prime.
  
  ## Examples
  
      iex> Caustic.Utils.mersenne_exponents_first(5)
      [2, 3, 5, 7, 13]
  """
  def mersenne_exponents_first(n) when is_integer(n) and n >= 0 and n <= length(@mersenne_exponents) do
    @mersenne_exponents
    |> Enum.take(n)
  end
  
  @doc """
  https://oeis.org/A000668
  https://en.wikipedia.org/wiki/Mersenne_prime
  The `i`-th Mersenne prime, starting at index 0.
  Primes of the form `2^p - 1` where `p` is a prime.
  
  ## Examples
  
      iex> Caustic.Utils.mersenne_prime(0)
      3
  """
  def mersenne_prime(i) when is_integer(i) and i >= 0 and i < length(@mersenne_primes) do
      @mersenne_primes |> Enum.at(i)
  end
  
  def mersenne_prime(i) when is_integer(i) and i >= 0 and i < length(@mersenne_exponents) do
    p = @mersenne_exponents |> Enum.at(i)
    pow(2, p) - 1
  end
  
  @doc """
  The first `n` primes.
  """
  def primes_first(n) when n >= 0 and n <= length(@primes) do
    @primes |> Enum.take(n)
  end
  
  @doc """
  The `i`-th prime, starting at index 0.
  
  ## Examples
  
      iex> Caustic.Utils.prime(0)
      2
      iex> Caustic.Utils.prime(1)
      3
      iex> Caustic.Utils.prime(1999)
      17389
      iex> Caustic.Utils.prime(2000)
      17393
      iex> Caustic.Utils.prime(9999)
      104729
      iex> Caustic.Utils.prime(99999)
      1299709
  """
  def prime(i) when is_integer(i) and i >= 0 and i < length(@primes) do
    @primes |> Enum.at(i)
  end
  
  def prime(i) when is_integer(i) and i >= 0 do
    # not precomputed
    current_index = length(@primes)
    current_candidate = List.last(@primes) + 2
    _find_prime(current_candidate, current_index, i)
  end
  
  def _find_prime(candidate, current_index, target_index) do
    if prime?(candidate) do
      if current_index == target_index do
        candidate
      else
        _find_prime(candidate + 2, current_index + 1, target_index)
      end
    else
      _find_prime(candidate + 2, current_index, target_index)
    end
  end

  @doc """
  Calculate the document hash, used for ECDSA.
  """
  def hash256(str), do: :crypto.hash(:sha256, :crypto.hash(:sha256, str))

  @doc """
  Calculate the md5 hash.
  """
  def md5(str), do: :crypto.hash(:md5, str)

  @doc """
  If an integer can be written as the sum of the squares of two positive integers,
  return those two integers {a, b} where a <= b.

  ## Examples

      iex> Caustic.Utils.to_sum_of_two_squares(17)
      {1, 4}
      iex> Caustic.Utils.to_sum_of_two_squares(1)
      nil
  """
  def to_sum_of_two_squares(i) when is_integer(i) and i > 0 do
    sqrt = trunc(:math.sqrt(i))
    _to_sum_of_two_squares(i, 1, 1, sqrt)
  end

  def _to_sum_of_two_squares(i, a, b, _) when a * a + b * b == i, do: {a, b}
  def _to_sum_of_two_squares(i, a, b, sqrt) when b + 1 <= sqrt, do: _to_sum_of_two_squares(i, a, b + 1, sqrt)
  def _to_sum_of_two_squares(i, a, _b, sqrt) when a + 1 <= sqrt, do: _to_sum_of_two_squares(i, a + 1, a + 1, sqrt)
  def _to_sum_of_two_squares(_, _, _, _), do: nil

  @doc """
  Checks whether `a` divides `b`.
  See https://math.stackexchange.com/questions/666103/why-would-some-elementary-number-theory-notes-exclude-00 and
  https://math.stackexchange.com/questions/2174535/does-zero-divide-zero

  ## Examples

      iex> Caustic.Utils.divides(2, 8)
      true
      iex> Caustic.Utils.divides(2, 3)
      false
      iex> Caustic.Utils.divides(2, 0)
      true
      iex> Caustic.Utils.divides(0, 0)
      true
  """
  def divides(a, 0) when is_integer(a), do: true
  def divides(0, b) when is_integer(b), do: false
  def divides(a, b) when is_integer(a) and is_integer(b), do: rem(b, a) == 0
  
  @doc """
  Solves the linear congruence ax = b (mod m).
  
  ## Examples
  
      iex> Caustic.Utils.linear_congruence_solve(1, 3, 4)
      [3]
      iex> Caustic.Utils.linear_congruence_solve(2, 1, 4)
      []
      iex> Caustic.Utils.linear_congruence_solve(2, 6, 4)
      [1, 3]
      iex> Caustic.Utils.linear_congruence_solve(0, 0, 3)
      [0, 1, 2]
      iex> Caustic.Utils.linear_congruence_solve(0, 1, 3)
      []
      iex> Caustic.Utils.linear_congruence_solve(0, 2, 3)
      []
      iex> Caustic.Utils.linear_congruence_solve(0, 3, 3)
      [0, 1, 2]
    
  """
  def linear_congruence_solve(a, b, m) when is_integer(a) and is_integer(m) and m > 0 do
    b = mod(b, m)
    d = gcd(a, m)
    if divides(d, b) do
      _linear_congruence_solve a, b, m, m
    else
      []
    end
  end

  defp _linear_congruence_solve(1, b, m, m_orig) do
    _linear_congruence_solutions [b], m, m_orig
  end
  
  defp _linear_congruence_solve(0, 0, _, m_orig) do
    _linear_congruence_solutions [0], 1, m_orig
  end
  
  defp _linear_congruence_solve(a, b, m, m_orig) do
    d = gcd(a, b)
    if d == 1 do
      _linear_congruence_solve a, b + m, m, m_orig
    else
      m = gcd(d, m)
      _linear_congruence_solve div(a, d), div(b, d), m, m_orig
    end
  end
  
  defp _linear_congruence_solutions(ns = [n | _], m, m_orig) when n + m >= m_orig do
    Enum.reverse(ns)
  end
  
  defp _linear_congruence_solutions(ns = [n | _], m, m_orig) do
    _linear_congruence_solutions [n + m | ns], m, m_orig
  end
  
  def multiplication_table_mod(m) when is_integer(m) and m > 0 do
    0..(m - 1)
    |> Enum.map(fn n ->
      0..(m - 1)
      |> Enum.map(& mod(n * &1, m))
    end)
  end
  
  def exponentiation_table_mod(m) when is_integer(m) and m > 0 do
    residues = 0..(m - 1)
    exponentiation_table_mod(m, residues, residues)
  end

  # technically with m=1, any number is congruent to 0
  # but rather than displaying 1^1=0 (mod 1) it's cleaner to display 1^1=1 (mod 1)
  def exponentiation_table_mod(1, [1], [1]), do: [[1]]

  def exponentiation_table_mod(m, rows, cols) when is_integer(m) and m > 0 do
    rows
    |> Enum.map(fn n ->
      cols
      |> Enum.map(fn
        e when n == 0 and e == 0 -> "?"
        e -> pow_mod(n, e, m)
      end)
    end)
  end
  
  @doc """
  Gets all the positive divisors of a number.
  
  ## Examples
  
      iex> Caustic.Utils.divisors(1)
      [1]
      iex> Caustic.Utils.divisors(3)
      [1, 3]
      iex> Caustic.Utils.divisors(6)
      [1, 2, 3, 6]
      iex> Caustic.Utils.divisors(-4)
      [1, 2, 4]
  """
  def divisors(n) when is_number(n) and n > 0 do
    {factors, exponents} = Enum.unzip factorize_grouped n

    result = exponents
    |> Enum.map(&Enum.to_list(0..&1))
    |> select()
    |> Enum.map(fn e ->
      Enum.zip(factors, e)
      |> Enum.map(fn {a, e} -> pow(a, e) end)
      |> Enum.reduce(1, &*/2)
    end)
    |> Enum.sort()
    
    if result == [], do: [1], else: result
  end
  
  def divisors(n) when is_number(n) and n < 0, do: divisors(-n)

  @doc """
  Gets all the positive divisors of a number, excluding the number itself.
  
  ## Examples
  
      iex> Caustic.Utils.proper_divisors(10)
      [1, 2, 5]
  """
  def proper_divisors(n) do
    divisors(n) -- [n]
  end

  @doc """
  Counts how many proper divisors an integer has. `d(n) - 1`.
  
  ## Examples
  
      iex> Caustic.Utils.proper_divisors_count(1)
      0
      iex> Caustic.Utils.proper_divisors_count(3)
      1
      iex> Caustic.Utils.proper_divisors_count(6)
      3
  """
  def proper_divisors_count(n) do
    divisors_count(n) - 1
  end
  
  @doc """
  ## Examples
  
      iex> Caustic.Utils.select([[:a, :b], [1, 2, 3]])
      [[:a, 1], [:a, 2], [:a, 3], [:b, 1], [:b, 2], [:b, 3]]
    
      iex> Caustic.Utils.select([[["hello"], ["bye"]], ["world"]])
      [[["hello"], "world"], [["bye"], "world"]]
  """
  def select([]), do: []
  def select([first | rest]) do
    _select rest, Enum.map(first, & [&1])
  end
  
  defp _select([], result), do: Enum.map(result, & Enum.reverse(&1))
  defp _select([next | rest], []), do: _select(rest, [next])
  defp _select([next | rest], result) do
    result = result
    |> Enum.flat_map(& Enum.map(next, fn n -> [n | &1] end))
    _select(rest, result)
  end
  
  @doc """
  Counts how many positive divisors an integer has. `d(n)`.
  
  ## Examples
  
      iex> Caustic.Utils.divisors_count(1)
      1
      iex> Caustic.Utils.divisors_count(3)
      2
      iex> Caustic.Utils.divisors_count(6)
      4
  """
  def divisors_count(n) do
    factorize_grouped(n)
    |> Enum.reduce(1, fn {_, e}, acc -> acc * (e + 1) end)
  end

  @doc """
  Sums the positive divisors of an integer. `(n)`.
  
  ## Examples
  
      iex> Caustic.Utils.divisors_sum(1)
      1
      iex> Caustic.Utils.divisors_sum(3)
      4
      iex> Caustic.Utils.divisors_sum(6)
      12
  """
  def divisors_sum(n) when n > 0 do
    factorize_grouped(n)
    |> Enum.reduce(1, fn {p, e}, acc -> acc * div((pow(p, e + 1) - 1), (p - 1)) end)
  end
  def divisors_sum(0), do: :infinity
  def divisors_sum(n) when n < 0 do
    divisors_sum(-n)
  end
  
  def proper_divisors_sum(n) when n > 0 do
    divisors_sum(n) - n
  end
  def proper_divisors_sum(0), do: :infinity
  
  @doc """
  The smallest number `t` such that `a^t = 1 (mod m)`.
  """
  def order_multiplicative(n, m) do
    if gcd(n, m) != 1, do: nil, else: _order_multiplicative(n, m)
  end
  
  defp _order_multiplicative(n, m) do
    totient(m)
    |> divisors()
    |> Enum.reduce(nil, fn
      candidate, nil -> if pow_mod(n, candidate, m) == 1, do: candidate, else: nil
      _, result -> result
    end)
  end
  
  @doc """
  Finds the primitive roots of a positive integer `m`.
  `a` is a primitive root of an integer `m` if `a` is a least residue
  and has order (`mod m`) of `t = (n)`.
  This means that `t` is the smallest number such that `a^t = 1 (mod m)`.
  """
  def primitive_roots(m) do
    1..m
    |> Enum.filter(&primitive_root?(&1, m))
  end
  
  @doc """
  Checks whether a number `n` is a primitive root modulo `m`.
  
  ## Examples
  
      iex> Caustic.Utils.primitive_root?(1, 5)
      false
      iex> Caustic.Utils.primitive_root?(4, 5)
      false
      iex> Caustic.Utils.primitive_root?(2, 5)
      true
  """
  def primitive_root?(n, m) when is_integer(m) and m > 0 do
    _primitive_root?(n, m)
  end
  
  # must be least residue
  def _primitive_root?(n, m) when n < 0 or n >= m, do: false
  
  def _primitive_root?(n, m), do: order_multiplicative(n, m) == totient(m)

  @doc """
  Finds all subsets of a set (represented by a keyword list).

  ## Examples

      iex> Caustic.Utils.subsets([:a])
      [[], [:a]]
      iex> Caustic.Utils.subsets([:a, :b, :c])
      [[], [:a], [:b], [:c], [:a, :b], [:a, :c], [:b, :c], [:a, :b, :c]]
  """
  def subsets(s) do
    (0..length(s))
    |> Enum.flat_map(& subsets(s, &1))
  end

  @doc """
  Finds all subsets with cardinality `n` of a set (represented by a keyword list).

  ## Examples

      iex> members = ["nakai", "kusanagi", "mori", "kimura", "katori", "inagaki"]
      iex> Caustic.Utils.subsets(members, 3)
      [
        ["nakai", "kusanagi", "mori"],
        ["nakai", "kusanagi", "kimura"],
        ["nakai", "kusanagi", "katori"],
        ["nakai", "kusanagi", "inagaki"],
        ["nakai", "mori", "kimura"],
        ["nakai", "mori", "katori"],
        ["nakai", "mori", "inagaki"],
        ["nakai", "kimura", "katori"],
        ["nakai", "kimura", "inagaki"],
        ["nakai", "katori", "inagaki"],
        ["kusanagi", "mori", "kimura"],
        ["kusanagi", "mori", "katori"],
        ["kusanagi", "mori", "inagaki"],
        ["kusanagi", "kimura", "katori"],
        ["kusanagi", "kimura", "inagaki"],
        ["kusanagi", "katori", "inagaki"],
        ["mori", "kimura", "katori"],
        ["mori", "kimura", "inagaki"],
        ["mori", "katori", "inagaki"],
        ["kimura", "katori", "inagaki"]
      ]
  """
  def subsets(s, n) when n >= 0 do
    _subsets([], [{[], s, n}])
  end

  def _subsets(result, []), do: Enum.reverse(result)

  def _subsets(result, [{_chosen, candidates, n} | pattern_rest]) when n > length(candidates) do
    _subsets(result, pattern_rest)
  end

  def _subsets(result, [{chosen, candidates, n} | pattern_rest]) when n == length(candidates) do
    _subsets([Enum.reverse(chosen) ++ candidates | result], pattern_rest)
  end

  def _subsets(result, [{chosen, _candidates, n} | pattern_rest]) when n == 0 do
    _subsets([Enum.reverse(chosen) | result], pattern_rest)
  end

  def _subsets(result, [{chosen, [candidate | candidates_rest], n} | pattern_rest]) do
    pattern_1 = {[candidate | chosen], candidates_rest, n - 1}
    pattern_2 = {chosen, candidates_rest, n}
    _subsets(result, [pattern_1, pattern_2] ++ pattern_rest)
  end
  
  def factorial(0), do: 1
  def factorial(n), do: n * factorial(n - 1)

  def pmap(collection, func) do
    collection
    |> Enum.map(&(Task.async(fn -> func.(&1) end)))
    |> Enum.map(&Task.await/1)
  end
end
